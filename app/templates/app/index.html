{% extends "app/layout.html" %}
{% load mathfilters %}

{% block head %}
    {% load staticfiles%}
    <link href="{% static 'app/content/bootstrap-datetimepicker.css' %}" rel="stylesheet">
    <title>Tripalocal | Experience it like a local</title>
    <!-- H1 google font -->
    <link href='http://fonts.googleapis.com/css?family=Exo:600,600italic' rel='stylesheet' type='text/css'>

	<script>
		$(function() {
			$("#slideshow > div:gt(0)").hide();
			setInterval(function() { 
			  $('#slideshow > div:first')
			    .fadeOut(1000)
			    .next()
			    .fadeIn(1000)
			    .end()
			    .appendTo('#slideshow');
			},  5000);
		});
	</script>
{% endblock %}

{% block content %}
    <div class="home-menu-bar">
        <ul class="home-menu menu">
        {% if user.is_authenticated %}
            <li><a id="language_switch_topbar" class="home-language" href="https://www.tripalocal.com/cn">中文</a></li>
            <li><a href="/accounts/logout/">Log out</a></li>
            <li>{{ user.first_name }}</li>
            <li><div class="profile-xs"><a href="/myprofile"><img src="{%if user.socialaccount_set.all%}http://graph.facebook.com/{% for u in user.socialaccount_set.all %}{% if forloop.first %}{{ u.uid }}{% endif %}{% endfor %}/picture?width=40&height=40{% elif user.registereduser.image_url and user.registereduser.image_url.strip%}{{ MEDIA_URL }}{{user.registereduser.image_url}}{%else%} {{ MEDIA_URL }}profile_default.jpg {%endif%}"/></a></div></li>    
        {% else %} 
            <li><a id="language_switch_topbar" class="home-language" href="https://www.tripalocal.com/cn">中文</a></li> 
            <li><a href="/accounts/signup/?next={{ request.path }}">Sign up</a></li>
            <li><a href="/accounts/login/?next={{ request.path }}">Log in</a></li>
        {% endif %}
        </ul>
    </div>

    <div class="jumbotron">
        <div class="container">
            <div class="homepage-logo"></div>
            <form id="search_form" action="" method="post">
                {% csrf_token %}
                <table class="home-search">
                    <tbody>
                        <tr>
                            <td class="search-location">{{form.city}}</td>
                            <td class="search-from">{{form.start_date}}</td>
                            <td class="search-to">{{form.end_date}}</td>
                            <td class="home-search-button"><input id="search-submit" type="submit" value="Search" name="search" class="btn btn-primary btn-sm btn-search"></td>
                            <td class="melbourne"><a href="https://www.tripalocal.com/s/melbourne">Melbourne</a></td>
                            <td class="sydney"><a href="https://www.tripalocal.com/s/sydney">Sydney</a></td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <div>
                <p>Tripalocal is currently available in Melbourne and Sydney </br>
                <a href="/accounts/signup/?next={{ request.path }}">Sign up</a> to get notified when we launch in more cities.</p>
            </div>
        </div>
    </div> 

    <div id="featured-exp">
        <div class="container">
            {% for experience, BGImageURL, profileImageURL in featuredExperienceList %}
                <div class="expList">
                    <a href="/experience/{{ experience.id }}">
                        <div class="listingImg" style="background-image:url({{ MEDIA_URL }}{{ BGImageURL }});">
                            <div class="priceBox">
                                From $<span>{{ experience.price|mul:1.429|floatformat:"0" }}</span> AUD/person
                            </div>
                        </div>
                    </a>
                    <a href="/experience/{{ experience.id }}"><h3>{{ formattedTitle }}</h3></a>

                    <div class="profile-sm" style="background:url(
                            {{ MEDIA_URL }}{{ profileImageURL }}) no-repeat; background-size:cover; background-position:center;"></div>
                </div>
            {% endfor %}

            {% for city, cityDisplayName in cityList %}
                <div class="expList">
                    <a href="{% url 'SearchView' city %}">
                        <div class="listingImg" style="background-image:url({{ MEDIA_URL }}city/{{ city }}.jpg);">
                            <p>{{ cityDisplayName }}</p>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>

    <div id="pitch-video">
        <div class="container">
            <iframe src="https://player.vimeo.com/video/130949891?title=0&byline=0&portrait=0" width="500"
                    height="281"
                    frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script charset="utf-8" type="text/javascript">
$(function()
{
    var country, region, city, ip, longitude, latitude;
    $(document).ready(function(){
        $("#id_city").attr("class","btn btn-default dropdown-toggle homepage-city");
        $("#id_start_date").attr("class","input-sm");
        $("#id_end_date").attr("class","input-sm");
        $("#id_start_date").attr("style","height:40px;");
        $("#id_end_date").attr("style","height:40px;");
        $("#id_start_date").attr("placeholder","From");
        $("#id_end_date").attr("placeholder","To");

        //hide loginpartial on homepage
        $(".navBox").attr("style","display:none");

        $.getScript('http://www.geoplugin.net/javascript.gp', function() 
        {
            country = geoplugin_countryName();
            region = geoplugin_region();
            city = geoplugin_city();
            ip = geoplugin_request();
            latitude = geoplugin_latitude();
            longitude = geoplugin_longitude();
        });

        $("#language_switch_topbar").click(function(){
            mixpanel.track("switched language from top bar");

            if($("#user_email").val())
            {
                mixpanel.identify($("#user_email").val());
            }
        });

        $("#id_start_date").click(function(){
            $("#id_start_date_picker").data("DateTimePicker").show();  
        });

        $("#id_end_date").click(function(){  
            $("#id_end_date_picker").data("DateTimePicker").show();  
        }); 

    });

    mixpanel.track("Visited homepage_en");

    if($("#user_email").val())
    {
        var now  = new Date().toString();
        mixpanel.people.set({"$country":country, "$region":region, "$city":city, "IP":ip, "Latitude":latitude, "Longitude":longitude});
        mixpanel.people.set({"$browser":navigator.userAgent, "$os":navigator.platform, "$initial_referrer": document.referrer,"$last_seen":now});  
        mixpanel.identify($("#user_email").val());
    }
})
</script>
{% endblock %}