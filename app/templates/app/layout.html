<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    {% load staticfiles %}
    {% load i18n %}

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <link rel="icon" href="{% static 'app/img/favicon.ico'%}" />
    <link rel="stylesheet" type="text/css" href="{% static 'app/content/site.css' %}" />
    <link href="{% static 'app/content/tripalocal.min.css' %}" rel="stylesheet">
    <link href="{% static 'app/content/tripalocal.css' %}" rel="stylesheet">
    {%if LANGUAGE == "zh-CN"%}
    <link href="{% static 'app/content/tripalocal_cn.css' %}" rel="stylesheet">
    {%else%}
    <link href="{% static 'app/content/tripalocal_en.css' %}" rel="stylesheet">
    {%endif%}

    {% if form %}
        {{ form.media }}
    {% endif %}

    {% block head %}
    <title> {{ title }} </title>
    {% endblock %}

    <style>
        input[type='number'] {
            -moz-appearance:textfield;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        select::-ms-expand {
            display: none;
        }
    </style>

<!-- Check user's device type -->
<script type="text/javascript">
// Minified version of isMobile included in the HTML since it's small
!function(a){var b=/iPhone/i,c=/iPod/i,d=/iPad/i,e=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,f=/Android/i,g=/IEMobile/i,h=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,i=/BlackBerry/i,j=/BB10/i,k=/Opera Mini/i,l=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,m=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),n=function(a,b){return a.test(b)},o=function(a){var o=a||navigator.userAgent,p=o.split("[FBAN");return"undefined"!=typeof p[1]&&(o=p[0]),this.apple={phone:n(b,o),ipod:n(c,o),tablet:!n(b,o)&&n(d,o),device:n(b,o)||n(c,o)||n(d,o)},this.android={phone:n(e,o),tablet:!n(e,o)&&n(f,o),device:n(e,o)||n(f,o)},this.windows={phone:n(g,o),tablet:n(h,o),device:n(g,o)||n(h,o)},this.other={blackberry:n(i,o),blackberry10:n(j,o),opera:n(k,o),firefox:n(l,o),device:n(i,o)||n(j,o)||n(k,o)||n(l,o)},this.seven_inch=n(m,o),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},p=function(){var a=new o;return a.Class=o,a};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=o:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=p():"function"==typeof define&&define.amd?define("isMobile",[],a.isMobile=p()):a.isMobile=p()}(this);
var deviceType = 'desktop';
if (isMobile.apple.phone) {deviceType = 'iPhone'};
if (isMobile.apple.tablet) {deviceType = 'iPad'};
if (isMobile.android.phone) {deviceType = 'android phone'};
if (isMobile.android.tablet) {deviceType = 'android tablet'};
if (isMobile.windows.phone) {deviceType = 'windows phone'};
if (isMobile.windows.tablet) {deviceType = 'windows tablet'};
if (isMobile.other.blackberry) {deviceType = 'blackberry'};
</script>

<!-- start Mixpanel --><script type="text/javascript">(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);

var productionHost = 'tripalocal.';

var devToken = 'c2510512c6cb4c34b4b32bd32a0cf866';
var prodToken = 'f94e94414c9de0cc38874706d853c400';

if (window.location.hostname.toLowerCase().search(productionHost) < 0) {
    mixpanel.init(devToken);
} else {
    mixpanel.init(prodToken);
}

mixpanel.register({'Device':deviceType})

</script><!-- end Mixpanel -->

<!-- start baidu statistics -->
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?454f88ea11e1916438f7d2c491e3c401";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- end baidu statistics -->

{%if LANGUAGE != "zh-CN"%}
<!--Start of Zopim Live Chat Script-->
<script type="text/javascript">
window.$zopim||(function(d,s){var z=$zopim=function(c){
z._.push(c)},$=z.s=
d.createElement(s),e=d.getElementsByTagName(s)[0];z.set=function(o){z.set.
_.push(o)};z._=[];z.set._=[];$.async=!0;$.setAttribute('charset','utf-8');
$.src='//v2.zopim.com/?2owMWFLtY3TJf5PtKGOcaVcaxAMrtupF';z.t=+new Date;$.
type='text/javascript';e.parentNode.insertBefore($,e)})(document,'script');
</script>
<!--End of Zopim Live Chat Script-->
{%endif%}
</head>

<body>
    <!-- Popup Modal -->
    <div class="modal fade" id="help-popup" tabindex="-1" role="dialog" aria-labelledby="help-popup">
        <div class="modal-dialog" role="document">
            <div class="modal-content help" style="background-image:url('{% static 'app/img/nightlight_web.jpg' %}')">
                <div id="popup-page-1">
                    <h1>{% trans "Do you need help planning your trip?" %}</h1>

                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-xs-6" style="float:left;">
                                    <button class="btn btn-primary" id="help-yes">{% trans "YES" %}</button>
                                </div>
                                <div class="col-xs-6" style="float:left;">
                                    <button class="btn btn-primary" id="help-no">{% trans "NO" %}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a class="close-popup">{% trans "Close" %}</a>
                </div>
                <div id="popup-page-2" hidden="true">
                    <h1>{% trans "Tell us about your trip" %}</h1>

                    <p>{% trans "and we will get back to you within 48 hours" %}</p>
                    <div id="results"></div>
                    <form id="custom-trip-form" class="popup-form" action="/email_custom_trip" method="POST">
                        {% csrf_token %}
                        <div class="form-group">
                            <textarea class="form-control" id="popup-form-details" rows="4"
                                      placeholder="Please tell us more details"></textarea>
                        </div>
                        <div class="form-group">
                            <input type="email" class="form-control" id="popup-form-email" placeholder="Email address">
                        </div>
                        <br>
                        <button class="btn btn-primary popup-form-submit" type="submit" value="send">Send</button>
                    </form>
                    <a class="close-popup">{% trans "close" %}</a>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        function create_post(email, message, popupTimmer) {
            $.ajax({
                url: "email_custom_trip",
                type: "POST",
                dataType: "json",
                data: {
                    csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']")[0].value,
                    message: message,
                    email: email
                },

                success: function (json) {
                    $('#popup-form-details').val('');
                    $('#popup-form-email').val('');
                    $('#results').html("<p class=''>Thank you for you suggestion.</p>");
                    clearInterval(popupTimmer);
                    $.cookie("closePopup", 2);
                },

                error: function (xhr, errmsg, err) {
                    $('#results').html("<p class=''>Oops! We have encountered an error.</p>");
                }
            });
        }

        $(document).ready(function () {
            var popupTimmer;

            if ($(window).width() > 520) {
                var nClose = parseInt($.cookie("closePopup"), 10);
                if (!nClose || nClose < 2) {
                    popupTimmer = setInterval(function () {
                        $('#help-popup').modal('show');
                        mixpanel.track("saw popup01");
                    }, 60000); // milliseconds
                }

                $('.close-popup').click(function () {
                    var nClose = parseInt($.cookie("closePopup"), 10);
                    if (nClose) {
                        if (nClose >= 2) {
                            clearInterval(popupTimmer);
                        } else {
                            $.cookie("closePopup", nClose + 1);
                        }
                    } else {
                        $.cookie("closePopup", 1);
                    }

                    $('#help-popup').modal('hide');
                    mixpanel.track("closed popup02");
                });

                $('#help-no').click(function () {
                    var nClose = parseInt($.cookie("closePopup"), 10);
                    if (nClose) {
                        if (nClose >= 2) {
                            clearInterval(popupTimmer);
                        } else {
                            $.cookie("closePopup", nClose + 1);
                        }
                    } else {
                        $.cookie("closePopup", 1);
                    }

                    $('#help-popup').modal('hide');
                    mixpanel.track("selected No from popup01");
                });

                $('#help-yes').click(function () {
                    $('#popup-page-1').hide();
                    $('#popup-page-2').show();
                    mixpanel.track("selected Yes from popup01");
                });

                $('#custom-trip-form').on('submit', function (event) {
                    event.preventDefault();

                    $('#results').empty();
                    email = $('#popup-form-email').val();
                    message = $('#popup-form-details').val();

                    if (!message || !email) {
                        $('#results').html("<p class=''>Please fill all fields.</p>");
                    } else {
                        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                        if (regex.test(email)) {
                            alert('Thanks.');
                            create_post(email, message, popupTimmer);
                        } else {
                            $('#results').html("<p class=''>Email Invalid.</p>");
                        }
                    }
                });
            }
        });
    </script>
    <!-- End Modal -->

    <div class="navBox">
        <input type="hidden" id="user_email" value="{{user_email}}" readonly>
        <table class="container-fluid" style="width:100%;">
            <tbody>
                <tr>
                    <td class="header">
                        <img class="hamburger notOnDesktop" src="{{ MEDIA_URL }}menu.svg" width="15" />
                        <a class="brand" href="https://www.tripalocal.com{{GEO_POSTFIX}}"><img src="{{ MEDIA_URL }}img/tripalocal_Logo.png" width="115" height="39"></a>
                    </td>
                    <td class="navbar-collapse notOnMobile">
                        {% include 'app/loginpartial.html' %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
{% block content %}{% endblock %}

    <div id="footer_div" class="footer">
        <div class="container">
            <div class="fixCenter">
                <div class="footer-wrapper">
                    <ul class="footer-head">
                        <li>
                            <select id="id_language_select" class="btn btn-default dropdown-toggle">
                                <option id="id_language_cn" value="cn">中文</option>
                                <option id="id_language_en" value="en">English</option>
                            </select>
                        </li>
                        <li class="footer-logo"></li>
                    </ul>

                    <div class="footer-body">
                        <ul class="footer-col company">
                            <li><h5>{% trans "Company" %}</h5></li>
                            <li><a href="{{GEO_POSTFIX}}aboutus">{% trans "About Us" %}</a></li>
                            <li><a href="{{GEO_POSTFIX}}contactus">{% trans "Contact Us" %}</a></li>
                            <li><a href="{{GEO_POSTFIX}}termsofservice">{% trans "Terms of Service" %}</a></li>
                            <li><a href="{{GEO_POSTFIX}}privacypolicy">{% trans "Privacy Policy" %}</a></li>
                            <!--<li id="mixpanel" style="margin-top:20px"><a href="https://mixpanel.com/f/partner"><img src="//cdn.mxpnl.com/site_media/images/partner/badge_blue.png" alt="Mobile Analytics" /></a></li>-->
                        </ul>
                        <ul class="footer-col travel">
                            <li><h5>{% trans "Travel" %}</h5></li>
                            <li><a href="{{GEO_POSTFIX}}refundpolicy">{% trans "Refund Policy" %}</a></li>
                            <!--<li><a href="{{GEO_POSTFIX}}mobileapps">{% trans "Mobile Apps" %}</a></li>-->
                        </ul>
                        <ul class="footer-col social">
                            <li><h5>{% trans "Social" %}</h5></li>
                            <li><a href="https://www.facebook.com/tripalocal">{% trans "Facebook" %}</a></li>
                            <li><a href="https://www.twitter.com/tripalocal">{% trans "Twitter" %}</a></li>
                            <!--<li><a href="https://www.twitter.com/tripalocal">{% trans "Instagram" %}</a></li>
                            <li><a href="https://www.twitter.com/tripalocal">{% trans "Weibo" %}</a></li>
                            <li><a href="https://www.twitter.com/tripalocal">{% trans "Wechat" %}</a></li>-->
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-line">
                <p id="copyright"> &#169; Tripalocal Pty. Ltd. ABN 46 600 546 549</p>
            </div>
        </div>
    </div>

{% block scripts %}{% endblock %}
<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
    // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
    // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/54ffb717718339d72a00001f.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>
</body>

<script>
    $(document).ready(function(){
        var des_url = window.location.pathname;
        if(des_url.indexOf("/cn") > -1)
        {
            $('#id_language_select').val('cn');
            $('#id_language_top').attr("href","https://www.tripalocal.com" + des_url.substring(3));
        }
        else if(window.location.href.indexOf(".cn") > -1)
        {
            $('#id_language_select').val('cn');
            $('#id_language_top').attr("href","https://www.tripalocal.com" + des_url);
        }
        else
        {
            $('#id_language_select').val('en');
            $('#id_language_top').attr("href","https://www.tripalocal.com/cn" + des_url);
        }
    });

    $('#id_language_select').change( function(){
        if("{{LANGUAGE}}" == "zh-CN")
        {
            mixpanel.track("switched language from footer_cn");
        }
        else
        {
            mixpanel.track("switched language from footer");
        }

        if($("#user_email").val())
        {
            mixpanel.identify($("#user_email").val());
        }

        var des_url = window.location.pathname;
        if ( $(this).val() == "cn" )
        {
            window.location.href = "https://www.tripalocal.com/cn" + des_url;
        }
        else
        {
            des_url = des_url.substring(3);
            window.location.href = "https://www.tripalocal.com" + des_url;
        }
    });

    $('#id_profile_div').click(function(){
        hide = $('#id_menu').attr('hide');
        if(hide == 'true')
        {
            $('#id_menu').attr('style','');
            $('#id_menu').attr('hide','false');
        }
        else
        {
            $('#id_menu').attr('style','display:none;');
            $('#id_menu').attr('hide','true');
        }
    });
</script>

<script>

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57471014-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
