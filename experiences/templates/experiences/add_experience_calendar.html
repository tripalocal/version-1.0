{% extends "app/layout.html" %}

{% load i18n %}

{% block head %}
    {% load staticfiles %}
    <script language="javascript" type="text/javascript" src="{% static 'app/scripts/fullcalendar.min.js' %}"></script>
    <script language="javascript" type="text/javascript" src="{% static 'app/scripts/date.js' %}"></script>
    <link href="{% static 'app/content/fullcalendar.min.css' %}" rel="stylesheet" />
	<link href="{% static 'app/content/fullcalendar.print.css' %}" rel="stylesheet" media="print" />
    <link href="{% static 'experiences/content/add_experience_calendar.css' %}" rel="stylesheet"/>

    <style>
    .fc-minor {
         display:none;
    }
    .fc-today{
        color: #EAF4F0 !important;
        background: #EAF4F0 !important;
        background-color: #EAF4F0 !important;
    }
    .fc-axis{
        color: #ccc;
    }
    .fc-widget-header{
        font-size:9px;
    }
    .fc-center{
        font-size:9px;
    }
    </style>

    {{ wizard.form.media }}
    <title>Add a new experience -- Calendar</title>
{% endblock %}

{% block content %}
<form id="form_calendar" action="" method="post" enctype="multipart/form-data">{% csrf_token %}
{{ wizard.management_form }}
{{ wizard.form.id }}
{{ wizard.form.changed_steps }}
<div class="back_button">
    <button name="wizard_save_exit_calendar" type="submit" val="" id="save-and-exit-top">Save and Exit</button>
</div>
<div>
{% if not edit %}
    <!-- left-side menu -->
    <div class="left-side-bar">
    <!-- Essential -->
   	    <p class="list-menu">Essential</p>
	
   	    <p class="list-tab" id="active-tab"><strong>Calender</strong></p>
   	    <p class="list-tab" ><strong>Pricing</strong></p>
   	    <p><img src="/images/pencil.jpg" alt="" class="modify-icon"></p>
    
        <!-- description -->
   	    <p class="list-menu">Description</p>
   	    <p class="list-tab" ><strong>Overview</strong></p>
	    <p><img src="/images/pencil.jpg" alt="" class="modify-icon"></p>
	    <p class="list-tab" ><strong>Details</strong></p>
	    <p><img src="/images/pencil.jpg" alt="" class="modify-icon"></p>
	    <p class="list-tab" ><strong>Photos</strong></p>
	    <p><img src="/images/pencil.jpg" alt="" class="modify-icon"></p>
	    <p class="list-tab" ><strong>Location</strong></p>
	    <p><img src="/images/pencil.jpg" alt="" class="modify-icon"></p>

        <!-- Steps Remaining -->
        <p id="steps-remaining">6 more steps<br>until publish!</p>
    </div>
    <!-- left-side menu ends -->
{%else%}
    <!-- left-side menu -->
    <div class="left-side-bar">
    <!-- Essential -->
   	    <p class="list-menu">Essential</p>
	
   	    <p class="list-tab" id="active-tab"><strong>Calender</strong></p>
   	    <button name="wizard_next_step" type="submit" value="price" class="list-tab-button"><strong>Pricing</strong></button>
    
        <!-- description -->
   	    <p class="list-menu">Description</p>
   	    <button name="wizard_next_step" type="submit" value="overview" class="list-tab-button"><strong>Overview</strong></button>
	    <button name="wizard_next_step" type="submit" value="detail" class="list-tab-button"><strong>Details</strong></button>
	    <button name="wizard_next_step" type="submit" value="photo" class="list-tab-button"><strong>Photos</strong></button>
	    <button name="wizard_next_step" type="submit" value="location" class="list-tab-button"><strong>Location</strong></button>
    </div>
    <!-- left-side menu ends -->
{%endif%}

    <!-- right-side calendar -->
{% if edit %}
    <input type="hidden" id="edit" value="true" readonly>
    <div class="calendar">
        <input type="hidden" id="saved" value="false" readonly>
        {{wizard.form.start_datetime}}
        {{wizard.form.end_datetime}}

        <div id='id_experience_calendar' style="width:540px;font-size:8px;margin-top:20px;margin-left:45px;padding-bottom:10px;"></div>

        <div id="blockout_title_1">
            <img src="/images/add.png" alt="">
            <strong>Create unavailable slots</strong>
            <img src="/images/unavailable.png" alt="">
        </div>
        <div id="blockout_1">
            <input id="id_cancel_blockout_1" type="button" value="Cancel">
            <input id="id_add_blockout_1" type="button" value="Create">

            From: {{wizard.form.blockout_start_datetime_1}}
            To: {{wizard.form.blockout_end_datetime_1}}
            {{wizard.form.blockout_repeat_1}} Repeat <br>
            <div id="blockout_repeat_1">
                Repeats:{{wizard.form.blockout_repeat_cycle_1}}
                Repeat every: {{wizard.form.blockout_repeat_frequency_1}} <label id="blockout_repeat_frequency_label_1">Weeks</label>
                <div id="blockout_repeat_on_1">
                    Repeat on:  <div><input id="blockout_repeat_on_sunday_1" type="checkbox">S</div>
                                <div><input id="blockout_repeat_on_monday_1" type="checkbox">M</div>
                                <div><input id="blockout_repeat_on_tuesday_1" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_wednesday_1" type="checkbox">W</div>
                                <div><input id="blockout_repeat_on_thursday_1" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_friday_1" type="checkbox">F</div>
                                <div><input id="blockout_repeat_on_saturday_1" type="checkbox">S</div>
                </div>
                <div id="blockout_repeat_by_1">
                    Repeat by:  <div><input id="blockout_repeat_by_date_1" type="radio" name="blockout_repeat_by_1">day of the month</div>
                                <div><input id="blockout_repeat_by_day_1" type="radio" name="blockout_repeat_by_1" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.blockout_repeat_end_date_1}}
                {{wizard.form.blockout_repeat_extra_information_1}}
            </div>
        </div>

        <div id="blockout_title_2">
            <img src="/images/add.png" alt="">
            <strong>Create unavailable slots</strong>
            <img src="/images/unavailable.png" alt="">
        </div>
        <div id="blockout_2">
            <input id="id_cancel_blockout_2" type="button" value="Cancel">
            <input id="id_add_blockout_2" type="button" value="Create">

            From: {{wizard.form.blockout_start_datetime_2}}
            To: {{wizard.form.blockout_end_datetime_2}}
            {{wizard.form.blockout_repeat_2}} Repeat <br>
            <div id="blockout_repeat_2">
                Repeats:{{wizard.form.blockout_repeat_cycle_2}}
                Repeat every: {{wizard.form.blockout_repeat_frequency_2}} <label id="blockout_repeat_frequency_label_2">Weeks</label>
                <div id="blockout_repeat_on_2">
                    Repeat on:  <div><input id="blockout_repeat_on_sunday_2" type="checkbox">S</div>
                                <div><input id="blockout_repeat_on_monday_2" type="checkbox">M</div>
                                <div><input id="blockout_repeat_on_tuesday_2" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_wednesday_2" type="checkbox">W</div>
                                <div><input id="blockout_repeat_on_thursday_2" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_friday_2" type="checkbox">F</div>
                                <div><input id="blockout_repeat_on_saturday_2" type="checkbox">S</div>
                </div>
                <div id="blockout_repeat_by_2">
                    Repeat by:  <div><input id="blockout_repeat_by_date_2" type="radio" name="blockout_repeat_by_2">day of the month</div>
                                <div><input id="blockout_repeat_by_day_2" type="radio" name="blockout_repeat_by_2" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.blockout_repeat_end_date_2}}
                {{wizard.form.blockout_repeat_extra_information_2}}
            </div>
        </div>

        <div id="blockout_title_3">
            <img src="/images/add.png" alt="">
            <strong>Create unavailable slots</strong>
            <img src="/images/unavailable.png" alt="">
        </div>
        <div id="blockout_3">
            <input id="id_cancel_blockout_3" type="button" value="Cancel">
            <input id="id_add_blockout_3" type="button" value="Create">

            From: {{wizard.form.blockout_start_datetime_3}}
            To: {{wizard.form.blockout_end_datetime_3}}
            {{wizard.form.blockout_repeat_3}} Repeat <br>
            <div id="blockout_repeat_3">
                Repeats:{{wizard.form.blockout_repeat_cycle_3}}
                Repeat every: {{wizard.form.blockout_repeat_frequency_3}} <label id="blockout_repeat_frequency_label_3">Weeks</label>
                <div id="blockout_repeat_on_3">
                    Repeat on:  <div><input id="blockout_repeat_on_sunday_3" type="checkbox">S</div>
                                <div><input id="blockout_repeat_on_monday_3" type="checkbox">M</div>
                                <div><input id="blockout_repeat_on_tuesday_3" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_wednesday_3" type="checkbox">W</div>
                                <div><input id="blockout_repeat_on_thursday_3" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_friday_3" type="checkbox">F</div>
                                <div><input id="blockout_repeat_on_saturday_3" type="checkbox">S</div>
                </div>
                <div id="blockout_repeat_by_3">
                    Repeat by:  <div><input id="blockout_repeat_by_date_3" type="radio" name="blockout_repeat_by_3">day of the month</div>
                                <div><input id="blockout_repeat_by_day_3" type="radio" name="blockout_repeat_by_3" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.blockout_repeat_end_date_3}}
                {{wizard.form.blockout_repeat_extra_information_3}}
            </div>
        </div>

        <div id="blockout_title_4">
            <img src="/images/add.png" alt="">
            <strong>Create unavailable slots</strong>
            <img src="/images/unavailable.png" alt="">
        </div>
        <div id="blockout_4">
            <input id="id_cancel_blockout_4" type="button" value="Cancel">
            <input id="id_add_blockout_4" type="button" value="Create">

            From: {{wizard.form.blockout_start_datetime_4}}
            To: {{wizard.form.blockout_end_datetime_4}}
            {{wizard.form.blockout_repeat_4}} Repeat <br>
            <div id="blockout_repeat_4">
                Repeats:{{wizard.form.blockout_repeat_cycle_4}}
                Repeat every: {{wizard.form.blockout_repeat_frequency_4}} <label id="blockout_repeat_frequency_label_4">Weeks</label>
                <div id="blockout_repeat_on_4">
                    Repeat on:  <div><input id="blockout_repeat_on_sunday_4" type="checkbox">S</div>
                                <div><input id="blockout_repeat_on_monday_4" type="checkbox">M</div>
                                <div><input id="blockout_repeat_on_tuesday_4" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_wednesday_4" type="checkbox">W</div>
                                <div><input id="blockout_repeat_on_thursday_4" type="checkbox">T</div>
                                <div><input id="blockout_repeat_on_friday_4" type="checkbox">F</div>
                                <div><input id="blockout_repeat_on_saturday_4" type="checkbox">S</div>
                </div>
                <div id="blockout_repeat_by_4">
                    Repeat by:  <div><input id="blockout_repeat_by_date_4" type="radio" name="blockout_repeat_by_4">day of the month</div>
                                <div><input id="blockout_repeat_by_day_4" type="radio" name="blockout_repeat_by_4" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.blockout_repeat_end_date_4}}
                {{wizard.form.blockout_repeat_extra_information_4}}
            </div>
        </div>

        <div id="blockout_title_5">
            <p>
                <img id="blockout_title_p_5" src="/images/add.png" alt="">
                <strong>Create unavailable slots</strong>
                <img src="/images/unavailable.png" alt="">
            </p>
        </div>
        <div id="blockout_5" class="section creating-slot-button-active create-slot-detail">
            <div style="float:right;">
                <input id="id_cancel_blockout_5" type="button" value="Cancel">
                <input id="id_add_blockout_5" type="button" value="Create">
            </div>

            <div id="slot-from">
                <p>From</p>
                {{wizard.form.blockout_start_datetime_5}}
            </div>
            <div id="slot-to">
                <p>To</p>
                {{wizard.form.blockout_end_datetime_5}}
            </div>
            <div id="repeat-checkbox">
                {{wizard.form.blockout_repeat_5}}
                <label for="id_calendar-blockout_repeat_5" name="checkbox2_lbl" class="css-label lite-cyan-check">Repeat ...</label>
            </div>
            <div id="blockout_repeat_5" class="creating-slot-button-active create-slot-repeat">
                <div class="repeat-frequency">
                    <p>Repeats</p>
                    {{wizard.form.blockout_repeat_cycle_5}}
                </div>
                <div class="repeat-every">
                    <p>Repeat every</p>
                    {{wizard.form.blockout_repeat_frequency_5}} <label id="blockout_repeat_frequency_label_5">Weeks</label>
                </div>
                <div id="blockout_repeat_on_5" class="repeats-on">
                    <p>Repeat on</p>  
                    <input id="blockout_repeat_on_sunday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_sunday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">S</label>
                    <input id="blockout_repeat_on_monday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_monday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">M</label>
                    <input id="blockout_repeat_on_tuesday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_tuesday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">T</label>
                    <input id="blockout_repeat_on_wednesday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_wednesday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">W</label>
                    <input id="blockout_repeat_on_thursday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_thursday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">T</label>
                    <input id="blockout_repeat_on_friday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_friday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">F</label>
                    <input id="blockout_repeat_on_saturday_5" type="checkbox" class="css-checkbox"><label for="blockout_repeat_on_saturday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">S</label>
                </div>
                <div id="blockout_repeat_by_5" class="repeats-on">
                    <p>Repeat by</p>
                    <input id="blockout_repeat_by_date_5" type="radio" name="blockout_repeat_by_5"> day of the month
                    <input id="blockout_repeat_by_day_5" type="radio" name="blockout_repeat_by_5" style="display:none;">
                </div>
                <div id="ends">
                    <p>Ends</p>
                    {{wizard.form.blockout_repeat_end_date_5}}
                </div>
                {{wizard.form.blockout_repeat_extra_information_5}}
            </div>
        </div>

        <div id="instant_booking_title_1">
            <img src="/images/add.png" alt="">
            <strong> Create instant booking slots</strong>
            <img src="/images/instant.png" alt="">
        </div>
        <div id="instant_booking_1">
            <input id="id_cancel_instant_booking_1" type="button" value="Cancel">
            <input id="id_add_instant_booking_1" type="button" value="Create">

            From: {{wizard.form.instant_booking_start_datetime_1}}
            To: {{wizard.form.instant_booking_end_datetime_1}}
            {{wizard.form.instant_booking_repeat_1}} Repeat <br>
            <div id="instant_booking_repeat_1">
                Repeats:{{wizard.form.instant_booking_repeat_cycle_1}}
                Repeat every: {{wizard.form.instant_booking_repeat_frequency_1}} <label id="instant_booking_repeat_frequency_label_1">Weeks</label>
                <div id="instant_booking_repeat_on_1">
                    Repeat on:  <div><input id="instant_booking_repeat_on_sunday_1" type="checkbox">S</div>
                                <div><input id="instant_booking_repeat_on_monday_1" type="checkbox">M</div>
                                <div><input id="instant_booking_repeat_on_tuesday_1" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_wednesday_1" type="checkbox">W</div>
                                <div><input id="instant_booking_repeat_on_thursday_1" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_friday_1" type="checkbox">F</div>
                                <div><input id="instant_booking_repeat_on_saturday_1" type="checkbox">S</div>
                </div>
                <div id="instant_booking_repeat_by_1">
                    Repeat by:  <div><input id="instant_booking_repeat_by_date_1" type="radio" name="instant_booking_repeat_by_1">day of the month</div>
                                <div><input id="instant_booking_repeat_by_day_1" type="radio" name="instant_booking_repeat_by_1" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.instant_booking_repeat_end_date_1}}
                {{wizard.form.instant_booking_repeat_extra_information_1}}
            </div>
        </div>

        <div id="instant_booking_title_2">
            <img src="/images/add.png" alt="">
            <strong> Create instant booking slots</strong>
            <img src="/images/instant.png" alt="">
        </div>
        <div id="instant_booking_2">
            <input id="id_cancel_instant_booking_2" type="button" value="Cancel">
            <input id="id_add_instant_booking_2" type="button" value="Create">

            From: {{wizard.form.instant_booking_start_datetime_2}}
            To: {{wizard.form.instant_booking_end_datetime_2}}
            {{wizard.form.instant_booking_repeat_2}} Repeat <br>
            <div id="instant_booking_repeat_2">
                Repeats:{{wizard.form.instant_booking_repeat_cycle_2}}
                Repeat every: {{wizard.form.instant_booking_repeat_frequency_2}} <label id="instant_booking_repeat_frequency_label_2">Weeks</label>
                <div id="instant_booking_repeat_on_2">
                    Repeat on:  <div><input id="instant_booking_repeat_on_sunday_2" type="checkbox">S</div>
                                <div><input id="instant_booking_repeat_on_monday_2" type="checkbox">M</div>
                                <div><input id="instant_booking_repeat_on_tuesday_2" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_wednesday_2" type="checkbox">W</div>
                                <div><input id="instant_booking_repeat_on_thursday_2" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_friday_2" type="checkbox">F</div>
                                <div><input id="instant_booking_repeat_on_saturday_2" type="checkbox">S</div>
                </div>
                <div id="instant_booking_repeat_by_2">
                    Repeat by:  <div><input id="instant_booking_repeat_by_date_2" type="radio" name="instant_booking_repeat_by_2">day of the month</div>
                                <div><input id="instant_booking_repeat_by_day_2" type="radio" name="instant_booking_repeat_by_2" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.instant_booking_repeat_end_date_2}}
                {{wizard.form.instant_booking_repeat_extra_information_2}}
            </div>
        </div>

        <div id="instant_booking_title_3">
            <img src="/images/add.png" alt="">
            <strong> Create instant booking slots</strong>
            <img src="/images/instant.png" alt="">
        </div>
        <div id="instant_booking_3">
            <input id="id_cancel_instant_booking_3" type="button" value="Cancel">
            <input id="id_add_instant_booking_3" type="button" value="Create">

            From: {{wizard.form.instant_booking_start_datetime_3}}
            To: {{wizard.form.instant_booking_end_datetime_3}}
            {{wizard.form.instant_booking_repeat_3}} Repeat <br>
            <div id="instant_booking_repeat_3">
                Repeats:{{wizard.form.instant_booking_repeat_cycle_3}}
                Repeat every: {{wizard.form.instant_booking_repeat_frequency_3}} <label id="instant_booking_repeat_frequency_label_3">Weeks</label>
                <div id="instant_booking_repeat_on_3">
                    Repeat on:  <div><input id="instant_booking_repeat_on_sunday_3" type="checkbox">S</div>
                                <div><input id="instant_booking_repeat_on_monday_3" type="checkbox">M</div>
                                <div><input id="instant_booking_repeat_on_tuesday_3" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_wednesday_3" type="checkbox">W</div>
                                <div><input id="instant_booking_repeat_on_thursday_3" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_friday_3" type="checkbox">F</div>
                                <div><input id="instant_booking_repeat_on_saturday_3" type="checkbox">S</div>
                </div>
                <div id="instant_booking_repeat_by_3">
                    Repeat by:  <div><input id="instant_booking_repeat_by_date_3" type="radio" name="instant_booking_repeat_by_3">day of the month</div>
                                <div><input id="instant_booking_repeat_by_day_3" type="radio" name="instant_booking_repeat_by_3" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.instant_booking_repeat_end_date_3}}
                {{wizard.form.instant_booking_repeat_extra_information_3}}
            </div>
        </div>

        <div id="instant_booking_title_4">
            <img src="/images/add.png" alt="">
            <strong> Create instant booking slots</strong>
            <img src="/images/instant.png" alt="">
        </div>
        <div id="instant_booking_4">
            <input id="id_cancel_instant_booking_4" type="button" value="Cancel">
            <input id="id_add_instant_booking_4" type="button" value="Create">

            From: {{wizard.form.instant_booking_start_datetime_4}}
            To: {{wizard.form.instant_booking_end_datetime_4}}
            {{wizard.form.instant_booking_repeat_4}} Repeat <br>
            <div id="instant_booking_repeat_4">
                Repeats:{{wizard.form.instant_booking_repeat_cycle_4}}
                Repeat every: {{wizard.form.instant_booking_repeat_frequency_4}} <label id="instant_booking_repeat_frequency_label_4">Weeks</label>
                <div id="instant_booking_repeat_on_4">
                    Repeat on:  <div><input id="instant_booking_repeat_on_sunday_4" type="checkbox">S</div>
                                <div><input id="instant_booking_repeat_on_monday_4" type="checkbox">M</div>
                                <div><input id="instant_booking_repeat_on_tuesday_4" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_wednesday_4" type="checkbox">W</div>
                                <div><input id="instant_booking_repeat_on_thursday_4" type="checkbox">T</div>
                                <div><input id="instant_booking_repeat_on_friday_4" type="checkbox">F</div>
                                <div><input id="instant_booking_repeat_on_saturday_4" type="checkbox">S</div>
                </div>
                <div id="instant_booking_repeat_by_4">
                    Repeat by:  <div><input id="instant_booking_repeat_by_date_4" type="radio" name="instant_booking_repeat_by_4">day of the month</div>
                                <div><input id="instant_booking_repeat_by_day_4" type="radio" name="instant_booking_repeat_by_4" style="display:none;"></div>
                </div>
                Ends: {{wizard.form.instant_booking_repeat_end_date_4}}
                {{wizard.form.instant_booking_repeat_extra_information_4}}
            </div>
        </div>

        <div id="instant_booking_title_5">
            <p>
                <img id="instant_booking_title_p_5" src="/images/add.png" alt="">
                <strong> Create instant booking slots</strong>
                <img src="/images/instant.png" alt="">
            </p>
        </div>
        <div id="instant_booking_5" class="section creating-slot-button-active create-slot-detail">
            <div style="float:right;">
                <input id="id_cancel_instant_booking_5" type="button" value="Cancel">
                <input id="id_add_instant_booking_5" type="button" value="Create">
            </div>

            <div id="slot-from">
                <p>From</p>
                {{wizard.form.instant_booking_start_datetime_5}}
            </div>
            <div id="slot-to">
                <p>To</p>
                {{wizard.form.instant_booking_end_datetime_5}}
            </div>
            <div id="repeat-checkbox">
                {{wizard.form.instant_booking_repeat_5}}
                <label for="id_calendar-instant_booking_repeat_5" name="checkbox2_lbl" class="css-label lite-cyan-check">Repeat ...</label>
            </div>
            <div id="instant_booking_repeat_5" class="creating-slot-button-active create-slot-repeat">
                <div class="repeat-frequency">
                    <p>Repeats</p>
                    {{wizard.form.instant_booking_repeat_cycle_5}}
                </div>
                <div class="repeat-every">
                    <p>Repeat every</p>
                    {{wizard.form.instant_booking_repeat_frequency_5}} <label id="instant_booking_repeat_frequency_label_5">Weeks</label>
                </div>
                <div id="instant_booking_repeat_on_5" class="repeats-on">
                    <p>Repeat on</p>  
                    <input id="instant_booking_repeat_on_sunday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_sunday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">S</label>
                    <input id="instant_booking_repeat_on_monday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_monday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">M</label>
                    <input id="instant_booking_repeat_on_tuesday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_tuesday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">T</label>
                    <input id="instant_booking_repeat_on_wednesday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_wednesday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">W</label>
                    <input id="instant_booking_repeat_on_thursday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_thursday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">T</label>
                    <input id="instant_booking_repeat_on_friday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_friday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">F</label>
                    <input id="instant_booking_repeat_on_saturday_5" type="checkbox" class="css-checkbox"><label for="instant_booking_repeat_on_saturday_5" name="checkbox2_lbl" class="css-label lite-cyan-check">S</label>
                </div>
                <div id="instant_booking_repeat_by_5" class="repeats-on">
                    <p>Repeat by</p>
                    <input id="instant_booking_repeat_by_date_5" type="radio" name="instant_booking_repeat_by_5"> day of the month
                    <input id="instant_booking_repeat_by_day_5" type="radio" name="instant_booking_repeat_by_5" style="display:none;">
                </div>
                <div id="ends">
                    <p>Ends</p>
                    {{wizard.form.instant_booking_repeat_end_date_5}}
                </div>
                {{wizard.form.instant_booking_repeat_extra_information_5}}
            </div>
        </div>
        <div class="section" style="text-align:right;">
            <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}" id="last-step">Last Step</button>
            <button name="wizard_save_exit_calendar" type="submit" value="" id="save-and-exit">Save and Exit</button>
            <input type="submit" value="Next Step" id="next-step" />
        </div>
    </div>
{%else%}
    <input type="hidden" id="edit" value="false" readonly>
    <div class="calendar">
        <p id="calendarIcon"><img src="/images/calendarIcon.jpg"></p>
        <p id="calendarText">Once you have submitted your experience, <br>you can manage your calendar here.</p>
        <p id="calendarIcon"><input type="submit" class="btn btn-primary btn-sm" id="understand" value="OK, I understand" style="color:#FFF; margin-bottom: 400px;"/></p>
    </div>
{%endif%}
    <!-- right-side calendar ends -->
    <!-- Info bar -->
    <div class="info-bar">
        <img src="/images/instant.png" alt="">
        <div id="instant-booking-text">
            <p>
                <span><strong>Instant booking</strong></span><br>
                <span>Allocate dates for instant</span><br>
                <span>booking will allow travellers to</span><br>
                <span>book their experiences</span><br>
                <span>instantly, and therefore, more</span><br>
                <span>likely for them to book with</span><br>
                <span>you. Also your listing will</span><br>
                <span>appear before hosts who don't</span><br>
                <span>often instant booking.</span>
            </p>
        </div>
        <br>
        <img src="/images/unavailable.png" alt="">
        <div id="unavailable-dates-text">
            <p>
                <span><strong>Unavailable dates</strong></span><br>
                <span>Only use this if you are cer-</span><br>
                <span>tain you wouldn't be avail-</span><br>
                <span>able during these period.</span>
            </p>
        </div>
    </div>
</div>
</form>
{% endblock %}

{% block scripts %}
<script charset="utf-8" type="text/javascript">
    function hideblockout_repeat(i) {
        $("#blockout_repeat_"+i).attr("style", "display:none;");
        //$("#blockout_repeat_on_"+i).attr("style", "display:none;");
        $("#blockout_repeat_by_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_cycle_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_frequency_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_end_date_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_end_date_"+i+"_picker").attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_extra_information_"+i).attr("style", "display:none;");
    }

    function showblockout_repeat(i) {
        $("#blockout_repeat_"+i).attr("style", "display:inline-block;");
        $("#id_calendar-blockout_repeat_cycle_"+i).attr("style", "");
        $("#id_calendar-blockout_repeat_frequency_"+i).attr("style", "");
        $("#id_calendar-blockout_repeat_end_date_"+i).attr("style", "");
        $("#id_calendar-blockout_repeat_end_date_"+i+"_picker").attr("style", "");

        if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim()=="Monthly")
        {
            $("#blockout_repeat_by_"+i).attr("style", "");
        }
    }

    function hideblockout(i) {
        $("#id_cancel_blockout_"+i).attr("style", "display:none;");
        $("#id_add_blockout_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_start_datetime_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_end_datetime_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_start_datetime_"+i+"_picker").attr("style", "display:none;");
        $("#id_calendar-blockout_end_datetime_"+i+"_picker").attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_"+i).attr("style", "display:none;");
        $("#id_calendar-blockout_repeat_"+i).attr("class", "css-checkbox");
        hideblockout_repeat(i);
    }

    function showblockout(i) {
        $("#id_cancel_blockout_"+i).attr("style", "");
        $("#id_add_blockout_"+i).attr("style", "");
        $("#id_calendar-blockout_start_datetime_"+i).attr("style", "");
        $("#id_calendar-blockout_end_datetime_"+i).attr("style", "");
        $("#id_calendar-blockout_start_datetime_"+i+"_picker").attr("style", "");
        $("#id_calendar-blockout_end_datetime_"+i+"_picker").attr("style", "");
        $("#id_calendar-blockout_repeat_"+i).attr("style", "");
        $("#id_calendar-blockout_repeat_"+i).attr("class", "css-checkbox");
    }

    function clearblockout(i) {
        $("#id_calendar-blockout_start_datetime_"+i).val("");
        $("#id_calendar-blockout_end_datetime_"+i).val("");
        $("#id_calendar-blockout_repeat_"+i).prop("checked", false);
        $("#blockout_repeat_on_sunday_"+i).prop("checked", false);
        $("#blockout_repeat_on_monday_"+i).prop("checked", false);
        $("#blockout_repeat_on_tuesday_"+i).prop("checked", false);
        $("#blockout_repeat_on_wednesday_"+i).prop("checked", false);
        $("#blockout_repeat_on_thursday_"+i).prop("checked", false);
        $("#blockout_repeat_on_friday_"+i).prop("checked", false);
        $("#blockout_repeat_on_saturday_"+i).prop("checked", false);
        $("#blockout_repeat_by_day_"+i).prop("checked", false);
        $("#blockout_repeat_by_date_"+i).prop("checked", true);
        $("select#id_calendar-blockout_repeat_cycle_"+i)[0].selectedIndex = 0;
        $("select#id_calendar-blockout_repeat_frequency_"+i)[0].selectedIndex = 0;
        $("#blockout_repeat_frequency_label_"+i).text('Days');
        $("#id_calendar-blockout_repeat_end_date_"+i).val("");
        $("#id_calendar-blockout_repeat_extra_information_"+i).val("");
    }

    function saveDailyEvent(option, i, color)
    {
        $('#id_experience_calendar').fullCalendar('addEventSource',        
            function(start, end, status, callback) {
                var events = [];
                var one_day = (24 * 60 * 60 * 1000);

                if($("#id_calendar-" + option + "_start_datetime_"+i).val() != '' && $("#id_calendar-" + option + "_end_datetime_"+i).val() != '')
                {
                    start_hour = parseInt($("#id_calendar-" + option + "_start_datetime_"+i).val().substr(-5,2));//"yyyy-MM-dd HH:mm");
                    end_hour = parseInt($("#id_calendar-" + option + "_end_datetime_"+i).val().substr(-5,2));//"yyyy-MM-dd HH:mm");

                    start_datetime = Date.parseExact($("#id_calendar-" + option + "_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    if($("#id_calendar-" + option + "_repeat_end_date_"+i).val() != '')
                    {
                        end_datetime = Date.parseExact($("#id_calendar-" + option + "_repeat_end_date_"+i).val(), "yyyy-MM-dd")
                    }
                    else
                    {
                        end_datetime = end._d;
                    }
                    if(start._d > start_datetime)
                    {
                        start_datetime = start._d;
                    }
                    if(end._d < end_datetime)
                    {
                        end_datetime = end._d;
                    }

                    for (j=0,loop = start_datetime.getTime();loop <= end_datetime.getTime();loop = loop + one_day, j++) 
                    {
                        if(j % parseInt($("#id_calendar-" + option + "_repeat_frequency_"+i).val()) != 0)
                        {
                            continue;
                        }

                        var column_date = new Date(loop);

                        events.push({
                            //title: option + '_'+i,
                            start: new Date(column_date.setHours(start_hour, 00)),
                            end: new Date(column_date.setHours(end_hour, 00)),
                            allDay: false,
                            id: option + '_'+i+'_'+j,
                            className: 'id' + option + '_'+i+'_'+j,
                            color: color,
                            textColor: color
                        });
                    } // for loop
                }

                // return events generated
                callback( events );
            }
        );
    }

    function saveWeeklyEvent(option, i, color)
    {
        $('#id_experience_calendar').fullCalendar('addEventSource',        
            function(start, end, status, callback) {
                var events = [];
                var one_day = (24 * 60 * 60 * 1000);

                if($("#id_calendar-" + option + "_start_datetime_"+i).val() != '' && $("#id_calendar-" + option + "_end_datetime_"+i).val() != '')
                {
                    start_hour = parseInt($("#id_calendar-" + option + "_start_datetime_"+i).val().substr(-5,2));//"yyyy-MM-dd HH:mm");
                    end_hour = parseInt($("#id_calendar-" + option + "_end_datetime_"+i).val().substr(-5,2));//"yyyy-MM-dd HH:mm");

                    start_datetime = Date.parseExact($("#id_calendar-" + option + "_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    start_weekofyear = start_datetime.getWeekOfYear();
                    if($("#id_calendar-" + option + "_repeat_end_date_"+i).val() != '')
                    {
                        end_datetime = Date.parseExact($("#id_calendar-" + option + "_repeat_end_date_"+i).val(), "yyyy-MM-dd")
                    }
                    else
                    {
                        end_datetime = end._d;
                    }
                    if(start._d > start_datetime)
                    {
                        start_datetime = start._d;
                    }
                    if(end._d < end_datetime)
                    {
                        end_datetime = end._d;
                    }

                    for (j=0,loop = start_datetime.getTime();loop <= end_datetime.getTime();loop = loop + one_day, j++) 
                    {
                        var column_date = new Date(loop);
                        current_weekofyear = column_date.getWeekOfYear();

                        if(Math.abs(current_weekofyear - start_weekofyear) % parseInt($("#id_calendar-" + option + "_repeat_frequency_"+i).val()) != 0)
                        {
                            continue;
                        }

                        if ($("#id_calendar-" + option + "_repeat_extra_information_"+i).val().indexOf(column_date.getDayName().toLowerCase()) >= 0) {
                            events.push({
                                //title: option + '_'+i,
                                start: new Date(column_date.setHours(start_hour, 00)),
                                end: new Date(column_date.setHours(end_hour, 00)),
                                allDay: false,
                                id: option + '_'+i+'_'+j,
                                className: 'id' + option + '_'+i+'_'+j,
                                color: color,
                                textColor: color
                            });
                        }
                    } // for loop
                }
                // return events generated
                callback( events );
            }
        );
    }

    function weekAndDay(date) {
        var days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],
            prefixes = ['First', 'Second', 'Third', 'Fourth', 'Fifth'];

        return prefixes[0 | date.getDate() / 7] + ' ' + days[date.getDay()];
    }

    function saveMonthlyEvent(option, i, color)
    {
        $('#id_experience_calendar').fullCalendar('addEventSource',        
            function(start, end, status, callback) {
                var events = [];
                var one_day = (24 * 60 * 60 * 1000);

                if($("#id_calendar-" + option + "_start_datetime_"+i).val() != '' && $("#id_calendar-" + option + "_end_datetime_"+i).val() != '')
                {
                    start_hour = parseInt($("#id_calendar-" + option + "_start_datetime_"+i).val().substr(-5,2));//"yyyy-MM-dd HH:mm");
                    end_hour = parseInt($("#id_calendar-" + option + "_end_datetime_"+i).val().substr(-5,2));//"yyyy-MM-dd HH:mm");

                    start_hour_original = start_hour;
                    end_hour_original = end_hour;

                    start_datetime = Date.parseExact($("#id_calendar-" + option + "_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    start_month = start_datetime.getMonth();
                    start_date = start_datetime.getDate();
                    start_week_day = weekAndDay(start_datetime);

                    end_date = Date.parseExact($("#id_calendar-" + option + "_end_datetime_"+i).val(), "yyyy-MM-dd HH:mm").getDate();

                    if($("#id_calendar-" + option + "_repeat_end_date_"+i).val() != '')
                    {
                        end_datetime = Date.parseExact($("#id_calendar-" + option + "_repeat_end_date_"+i).val(), "yyyy-MM-dd")
                    }
                    else
                    {
                        end_datetime = end._d;
                    }
                    if(start._d > start_datetime)
                    {
                        start_datetime = start._d;
                    }
                    if(end._d < end_datetime)
                    {
                        end_datetime = end._d;
                    }

                    for (j=0,loop = start_datetime.getTime();loop <= end_datetime.getTime();loop = loop + one_day, j++) 
                    {
                        var column_date = new Date(loop);
                        current_month = column_date.getMonth();
                        current_date = column_date.getDate();
                        current_week_day = weekAndDay(column_date);

                        if(Math.abs(current_month - start_month) % parseInt($("#id_calendar-" + option + "_repeat_frequency_"+i).val()) != 0)
                        {
                            continue;
                        }

                        if($("#id_calendar-" + option + "_repeat_extra_information_"+i).val() == "day" && current_week_day!=start_week_day)
                        {
                            continue;
                        }
                        if($("#id_calendar-" + option + "_repeat_extra_information_"+i).val() == "date") //repeat monthly by date
                        {
                            if(current_date < start_date || current_date > end_date)
                            {
                                continue;
                            }
                            else if(current_date == start_date)
                            {
                                start_hour=start_hour_original;
                                end_hour=23;
                            }
                            else if(current_date == end_date)
                            {
                                start_hour=0;
                                end_hour=end_hour_original;
                            }
                            else
                            {
                                start_hour=0;
                                end_hour=23;
                            }
                        }

                        events.push({
                            //title: option + '_'+i,
                            start: new Date(column_date.setHours(start_hour, 00)),
                            end: new Date(column_date.setHours(end_hour, 00)),
                            allDay: false,
                            id: option + '_'+i+'_'+j,
                            className: 'id' + option + '_'+i+'_'+j,
                            color: color,
                            textColor: color
                        });
                    } // for loop
                }
                // return events generated
                callback( events );
            }
        );
    }

    function saveSingleEvent(option, i, color)
    {
        start_datetime = Date.parseExact($("#id_calendar-" + option + "_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
        end_datetime = Date.parseExact($("#id_calendar-" + option + "_end_datetime_"+i).val(), "yyyy-MM-dd HH:mm");

        if(start_datetime && end_datetime)
        {
            start_datetime.setMinutes(0);
            end_datetime.setMinutes(0);

            single_event = new Object();
            single_event.start=start_datetime;
            single_event.end=end_datetime;
            single_event.allDay=false;
            single_event.id=option + '_'+i+'_0';
            single_event.className='id' + option + '_'+i+'_0';
            single_event.color=color;
            single_event.textColor=color;
            $('#id_experience_calendar').fullCalendar('addEventSource', [single_event]);
        }
    }

    function saveblockout(i) {
        //copy blockout_5 to blockout_i
        if(i!=5)
        {
            $("#id_calendar-blockout_start_datetime_"+i).val($("#id_calendar-blockout_start_datetime_5").val());
            $("#id_calendar-blockout_end_datetime_"+i).val($("#id_calendar-blockout_end_datetime_5").val());
            $("#id_calendar-blockout_repeat_"+i).prop("checked", $("#id_calendar-blockout_repeat_5").is(" :checked"));
            $("#id_calendar-blockout_repeat_cycle_"+i).val($("#id_calendar-blockout_repeat_cycle_5").val());
            $("#id_calendar-blockout_repeat_frequency_"+i).val($("#id_calendar-blockout_repeat_frequency_5").val());
            $("#id_calendar-blockout_repeat_end_date_"+i).val($("#id_calendar-blockout_repeat_end_date_5").val());
        }

        if($("#id_calendar-blockout_repeat_"+i).is(" :checked"))
        {
            if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim() == "Daily")
            {
                //add the event to the calendar
                saveDailyEvent("blockout", i, "#FB0F1C");
            }
            else if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim() == "Weekly")
            {
                days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];

                for(index=0;index<7;index++)
                {
                    if($("#blockout_repeat_on_" + days[index] + "_5").is(" :checked")) //_5, not _i
                    {
                        str = $("#id_calendar-blockout_repeat_extra_information_"+i).val();
                        $("#id_calendar-blockout_repeat_extra_information_"+i).val(str+days[index]+";");
                    }
                }
                saveWeeklyEvent("blockout", i, "#FB0F1C");
            }
            else if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim() == "Monthly")
            {
                //if($("#blockout_repeat_by_day_5").is(" :checked")) //_5, not _i
                //{
                //    $("#id_calendar-blockout_repeat_extra_information_"+i).val("day");
                //}
                //else //repeat by date
                //{
                    $("#id_calendar-blockout_repeat_extra_information_"+i).val("date");
                //}

                saveMonthlyEvent("blockout", i, "#FB0F1C");
            }
        }
        else if($("#id_calendar-blockout_start_datetime_"+i).val() != '' && $("#id_calendar-blockout_end_datetime_"+i).val() != '')
        {
            saveSingleEvent("blockout", i, "#FB0F1C");
        }
    }

    function hideinstantbooking_repeat(i) {
        $("#instant_booking_repeat_"+i).attr("style", "display:none;");
        //$("#instant_booking_repeat_on_"+i).attr("style", "display:none;");
        $("#instant_booking_repeat_by_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_cycle_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_frequency_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_end_date_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_end_date_"+i+"_picker").attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_extra_information_"+i).attr("style", "display:none;");
    }

    function showinstantbooking_repeat(i) {
        $("#instant_booking_repeat_"+i).attr("style", "display:inline-block;");
        $("#id_calendar-instant_booking_repeat_cycle_"+i).attr("style", "");
        $("#id_calendar-instant_booking_repeat_frequency_"+i).attr("style", "");
        $("#id_calendar-instant_booking_repeat_end_date_"+i).attr("style", "");
        $("#id_calendar-instant_booking_repeat_end_date_"+i+"_picker").attr("style", "");

        if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim()=="Monthly")
        {
            $("#instant_booking_repeat_by_"+i).attr("style", "");
        }
    }

    function hideinstantbooking(i) {
        $("#id_cancel_instant_booking_"+i).attr("style", "display:none;");
        $("#id_add_instant_booking_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_start_datetime_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_end_datetime_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_start_datetime_"+i+"_picker").attr("style", "display:none;");
        $("#id_calendar-instant_booking_end_datetime_"+i+"_picker").attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_"+i).attr("style", "display:none;");
        $("#id_calendar-instant_booking_repeat_"+i).attr("class", "css-checkbox");
        hideinstantbooking_repeat(i);
    }

    function showinstantbooking(i) {
        $("#id_cancel_instant_booking_"+i).attr("style", "");
        $("#id_add_instant_booking_"+i).attr("style", "");
        $("#id_calendar-instant_booking_start_datetime_"+i).attr("style", "");
        $("#id_calendar-instant_booking_end_datetime_"+i).attr("style", "");
        $("#id_calendar-instant_booking_start_datetime_"+i+"_picker").attr("style", "");
        $("#id_calendar-instant_booking_end_datetime_"+i+"_picker").attr("style", "");
        $("#id_calendar-instant_booking_repeat_"+i).attr("style", "");
        $("#id_calendar-instant_booking_repeat_"+i).attr("class", "css-checkbox");
    }

    function clearinstantbooking(i) {
        $("#id_calendar-instant_booking_start_datetime_"+i).val("");
        $("#id_calendar-instant_booking_end_datetime_"+i).val("");
        $("#id_calendar-instant_booking_repeat_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_sunday_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_monday_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_tuesday_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_wednesday_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_thursday_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_friday_"+i).prop("checked", false);
        $("#instant_booking_repeat_on_saturday_"+i).prop("checked", false);
        $("#instant_booking_repeat_by_day_"+i).prop("checked", false);
        $("#instant_booking_repeat_by_date_"+i).prop("checked", true);
        $("select#id_calendar-instant_booking_repeat_cycle_"+i)[0].selectedIndex = 0;
        $("select#id_calendar-instant_booking_repeat_frequency_"+i)[0].selectedIndex = 0;
        $("#instant_booking_repeat_frequency_label_"+i).text('Days');
        $("#id_calendar-instant_booking_repeat_end_date_"+i).val("");
        $("#id_calendar-instant_booking_repeat_extra_information_"+i).val("");
    }

    function saveinstantbooking(i) {
        //copy instant_booking_5 to instant_booking_i
        if(i!=5)
        {
            $("#id_calendar-instant_booking_start_datetime_"+i).val($("#id_calendar-instant_booking_start_datetime_5").val());
            $("#id_calendar-instant_booking_end_datetime_"+i).val($("#id_calendar-instant_booking_end_datetime_5").val());
            $("#id_calendar-instant_booking_repeat_"+i).prop("checked", $("#id_calendar-instant_booking_repeat_5").is(" :checked"));
            $("#id_calendar-instant_booking_repeat_cycle_"+i).val($("#id_calendar-instant_booking_repeat_cycle_5").val());
            $("#id_calendar-instant_booking_repeat_frequency_"+i).val($("#id_calendar-instant_booking_repeat_frequency_5").val());
            $("#id_calendar-instant_booking_repeat_end_date_"+i).val($("#id_calendar-instant_booking_repeat_end_date_5").val());
        }

        if($("#id_calendar-instant_booking_repeat_"+i).is(" :checked"))
        {
            if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim() == "Daily")
            {
                //add the event to the calendar
                saveDailyEvent("instant_booking", i, "#FECB2F");
            }
            else if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim() == "Weekly")
            {
                //$("#id_calendar-instant_booking_repeat_extra_information_"+i).val() should be empty now
                days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];

                for(index=0;index<7;index++)
                {
                    if($("#instant_booking_repeat_on_" + days[index] + "_5").is(" :checked")) //_5, not _i
                    {
                        str = $("#id_calendar-instant_booking_repeat_extra_information_"+i).val();
                        $("#id_calendar-instant_booking_repeat_extra_information_"+i).val(str+days[index]+";");
                    }
                }

                saveWeeklyEvent("instant_booking", i, "#FECB2F");
            }
            else if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim() == "Monthly")
            {
                //if($("#instant_booking_repeat_by_day_5").is(" :checked")) //_5, not _i
                //{
                //    $("#id_calendar-instant_booking_repeat_extra_information_"+i).val("day");
                //}
                //else //repeat by date
                //{
                    $("#id_calendar-instant_booking_repeat_extra_information_"+i).val("date");
                //}

                saveMonthlyEvent("instant_booking", i, "#FECB2F");
            }
        }
        else if($("#id_calendar-instant_booking_start_datetime_"+i).val() != '' && $("#id_calendar-instant_booking_end_datetime_"+i).val() != '')
        {
            saveSingleEvent("instant_booking", i, "#FECB2F");
        }
    }

    function handleAddingItem(option, i)
    {
        //update title
        if(option == "instant_booking")
        {
            image = "instant";
            text = "instant booking";
        }
        else
        {
            image = "unavailable";
            text = "unavailable";
        }

        $("#" + option + "_title_"+i).attr("class", "section next-slot");
        if(!$("#id_calendar-" + option + "_repeat_"+i).is(':checked'))
        {
            $("#" + option + "_title_"+i).html("<p><img src=\"/images/" + image + ".png\" alt=\"\"><span style=\"padding-top:10px;\"><span>"
                + "Next " + text + " slot: " 
                + $("#id_calendar-" + option + "_start_datetime_"+i).val().split(':')[0] + ":00" + " to "
                + $("#id_calendar-" + option + "_end_datetime_"+i).val().split(':')[0] + ":00")
                + "</span></span>";
        }
        else
        {
            $("#" + option + "_title_"+i).html("<p><img src=\"/images/" + image + ".png\" alt=\"\"><span style=\"padding-top:10px;\"><span>"
                + "Next " + text + " slot: " 
                + $("#id_calendar-" + option + "_start_datetime_"+i).val().split(':')[0] + ":00" + " to "
                + $("#id_calendar-" + option + "_end_datetime_"+i).val().split(':')[0] + ":00" + ", </span><br><span>repeats " 
                + $("#id_calendar-" + option + "_repeat_cycle_"+i).val().trim().toLowerCase())
                + "</span></span>";
        }
        //$("#" + option + "_"+i+" :input").attr("disabled", true);
        //unhook click
        $("#" + option + "_title_p_"+i).unbind("click");
        //add delete button
        $("#" + option + "_title_"+i).append("<input id='id_delete_" + option + "_"+i+"' type='button' style=\"border:none;background:url('/images/close.png') no-repeat\" class=\"close-tag\">");
        $("#id_delete_" + option + "_"+i).click(function(e){
            i = e.target.id.substr(-1,1);

            //remove the events from the calendar
            //only need to remove the events on the current view (check addEventSource)
            for(j=0;j<7;j++)
            {
                $('#id_experience_calendar').fullCalendar('removeEvents', option + '_'+i+'_'+j);
            }

            //the user created 5 slots, and now want to delete one. If the one to be deleted is not the 5th one, copy the 5th to the ith, and "delete" the 5th
            if($("#" + option + "_title_p_5").length == 0 && i!=5)
            {
                //delete the 5th slot
                for(j=0;j<7;j++)
                {
                    $('#id_experience_calendar').fullCalendar('removeEvents', option + '_5_'+j);
                }

                if(option == "blockout")
                {
                    saveblockout(i);
                    //copy the 5th slot
                    if($("#id_calendar-"+option+"_repeat_"+i).is(" :checked"))
                    {
                        if($("#id_calendar-"+option+"_repeat_cycle_"+i).val().trim() == "Daily")
                        {
                            saveDailyEvent(option, i, "#FB0F1C");
                        }
                        else if($("#id_calendar-"+option+"_repeat_cycle_"+i).val().trim() == "Weekly")
                        {
                            saveWeeklyEvent(option, i, "#FB0F1C");
                        }
                        else if($("#id_calendar-"+option+"repeat_cycle_"+i).val().trim() == "Monthly")
                        {
                            saveMonthlyEvent(option, i, "#FB0F1C");
                        }
                    }
                    else
                    {
                        saveSingleEvent(option, i, "#FB0F1C");
                    }
                }
                else
                {
                    saveinstantbooking(i);
                    //copy the 5th slot
                    if($("#id_calendar-"+option+"_repeat_"+i).is(" :checked"))
                    {
                        if($("#id_calendar-"+option+"_repeat_cycle_"+i).val().trim() == "Daily")
                        {
                            saveDailyEvent(option, i, "#FECB2F");
                        }
                        else if($("#id_calendar-"+option+"_repeat_cycle_"+i).val().trim() == "Weekly")
                        {
                            saveWeeklyEvent(option, i, "#FECB2F");
                        }
                        else if($("#id_calendar-"+option+"repeat_cycle_"+i).val().trim() == "Monthly")
                        {
                            saveMonthlyEvent(option, i, "#FECB2F");
                        }
                    }
                    else
                    {
                        saveSingleEvent(option, i, "#FECB2F");
                    }
                }

                $("#" + option + "_title_"+i).children("p").children("span").children("span").text($("#" + option + "_title_5").children("p").children("span").children("span").text());

                i=5;
            }

            //reset title
            if(option == "blockout")
            {
                $("#" + option + "_title_"+i).html("<p><img id='blockout_title_p_"+i+"' src='/images/add.png' alt=''><strong> Create unavailable slots</strong><img src='/images/unavailable.png' alt=''></p>");
            }
            else
            {
                $("#" + option + "_title_"+i).html("<p><img id='instant_booking_title_p_"+i+"' src='/images/add.png' alt=''><strong> Create instant booking slots</strong><img src='/images/instant.png' alt=''></p>");
            }

            //rehook click event
            $("#" + option + "_title_p_"+i).click(function(e){
                i = e.target.id.substr(-1,1);
                if(e.target.id != "id_delete_" + option + "_"+i)
                {
                    $("#" + option + "_"+i).attr("style", "display:inline-block;");
                    if(option == "blockout")
                    {
                        showblockout(i);
                    }
                    else
                    {
                        showinstantbooking(i);
                    }
                }
            });

            $("#" + option + "_"+i).attr("style", "display:none;");
            $("#" + option + "_title_"+i).attr("style", "display:none;");
            $("#" + option + "_"+5).attr("class", "section creating-slot-button-active create-slot-detail");
            $("#" + option + "_title_"+5).attr("class", "section creating-slot-button");
            $("#" + option + "_title_"+5).attr("style", "display:inline-block;");

            if(option == "blockout")
            {
                clearblockout(i);
                hideblockout(i);
            }
            else
            {
                clearinstantbooking(i);
                hideinstantbooking(i);
            }
        });
    }

    function saveandexit()
    {
        for(i=1;i<=5;i++)
        {
            if($("#blockout_"+i).attr("style")!="display:none;")
            {
                $("#id_add_blockout_"+i).click();
            }
            if($("#instant_booking_"+i).attr("style")!="display:none;")
            {
                $("#id_add_instant_booking_"+i).click();
            }
        }
    }

    $(document).ready(function(){
        $('body').attr('id','background-white');
        $("#id_calendar-changed_steps").val($("#id_calendar-changed_steps").val()+'calendar,');
        now = new Date();
        if($('#id_calendar-start_datetime').val() == "")
        {
            $('#id_calendar-start_datetime').val(now.toString("yyyy-MM-dd HH:mm"));
            $('#id_calendar-end_datetime').val(now.addYears(10).toString("yyyy-MM-dd HH:mm"));
        }

        $('#id_calendar-start_datetime').prop('readonly', true);
        $('#id_calendar-end_datetime').prop('readonly', true);
        $('#id_calendar-start_datetime').hide();
        $('#id_calendar-end_datetime').hide();
        $('#id_calendar-start_datetime_picker').hide();
        $('#id_calendar-end_datetime_picker').hide();

        $('#id_experience_calendar').fullCalendar(
		{
			header:
			{
				left: 'prev,next today',
				center: 'title',
				right: ''
			},

            height:355,
            //contentHeight:340,
            //aspectRatio: 1.5,
			defaultView: 'agendaWeek',
			selectable: false,
			selectHelper: false,
            allDaySlot:false,
		});

        //always leave the last one as a "draft" to fill
        //once clicked "create", copy it to the next blank one starting from 1
        for(i=1;i<=4;i++)
        {
            $("#blockout_title_"+i).attr("style", "display:none;");
            $("#instant_booking_title_"+i).attr("style", "display:none;");
        }

        for(i=1;i<=5;i++)
        {
            $("#instant_booking_title_"+i).attr("class","section creating-slot-button");
            $("#blockout_title_"+i).attr("class","section creating-slot-button");

            $("#blockout_"+i).attr("style", "display:none;");
            $("#instant_booking_"+i).attr("style", "display:none;");

            hideblockout(i);
            hideinstantbooking(i);

            $("#blockout_title_p_"+i).click(function(e){
                i = e.target.id.substr(-1,1);
                $("#blockout_"+i).attr("style", "display:inline-block;");
                showblockout(i);
            });

            $("#instant_booking_title_p_"+i).click(function(e){
                i = e.target.id.substr(-1,1);
                $("#instant_booking_"+i).attr("style", "display:inline-block;");
                showinstantbooking(i);
            });

            $("#id_calendar-blockout_repeat_"+i).change(function(e) {
                if($(this).is(":checked")) {
                    showblockout_repeat(e.target.id.substr(-1,1));
                }
                else {
                    hideblockout_repeat(e.target.id.substr(-1,1));
                }      
            });

            $("#id_calendar-instant_booking_repeat_"+i).change(function(e) {
                if($(this).is(":checked")) {
                    showinstantbooking_repeat(e.target.id.substr(-1,1));
                }
                else {
                    hideinstantbooking_repeat(e.target.id.substr(-1,1));
                }      
            });

            $("#id_calendar-blockout_repeat_cycle_"+i).change(function(e){
                i = e.target.id.substr(-1,1);
                if($("#"+e.target.id).val().trim()=="Daily")
                {
                    $("#blockout_repeat_frequency_label_"+i).text('Days');
                    $("#blockout_repeat_on_"+i).attr("style", "display:none;");
                    $("#blockout_repeat_by_"+i).attr("style", "display:none;");
                    $("#id_calendar-blockout_repeat_extra_information_"+i).val("");
                }
                else if($("#"+e.target.id).val().trim()=="Weekly")
                {
                    $("#blockout_repeat_frequency_label_"+i).text('Weeks');
                    $("#blockout_repeat_on_"+i).attr("style", "");
                    $("#blockout_repeat_by_"+i).attr("style", "display:none;");
                    $("#id_calendar-blockout_repeat_extra_information_"+i).val("");
                    if($("#id_calendar-blockout_start_datetime_"+i).val() != '')
                    {
                        start_day = Date.parseExact($("#id_calendar-blockout_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm").getDay();
                        days = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
                        $("#blockout_repeat_on_"+days[start_day]+"_"+i).prop("checked", true);
                    }
                }
                else
                {
                    $("#blockout_repeat_frequency_label_"+i).text('Months');
                    $("#blockout_repeat_on_"+i).attr("style", "display:none;");
                    $("#blockout_repeat_by_"+i).attr("style", "");
                    $("#id_calendar-blockout_repeat_extra_information_"+i).val("");
                    $("#blockout_repeat_by_date"+i).prop("checked", true);
                }
            });

            $("#id_calendar-instant_booking_repeat_cycle_"+i).change(function(e){
                i = e.target.id.substr(-1,1);
                if($("#"+e.target.id).val().trim()=="Daily")
                {
                    $("#instant_booking_repeat_frequency_label_"+i).text('Days');
                    $("#instant_booking_repeat_on_"+i).attr("style", "display:none;");
                    $("#instant_booking_repeat_by_"+i).attr("style", "display:none;");
                }
                else if($("#"+e.target.id).val().trim()=="Weekly")
                {
                    $("#instant_booking_repeat_frequency_label_"+i).text('Weeks');
                    $("#instant_booking_repeat_on_"+i).attr("style", "");
                    $("#instant_booking_repeat_by_"+i).attr("style", "display:none;");
                    if($("#id_calendar-instant_booking_start_datetime_"+i).val() != '')
                    {
                        start_day = Date.parseExact($("#id_calendar-instant_booking_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm").getDay();
                        days = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
                        $("#instant_booking_repeat_on_"+days[start_day]+"_"+i).prop("checked", true);
                    }
                }
                else
                {
                    $("#instant_booking_repeat_frequency_label_"+i).text('Months');
                    $("#instant_booking_repeat_on_"+i).attr("style", "display:none;");
                    $("#instant_booking_repeat_by_"+i).attr("style", "");
                    $("#id_calendar-instant_booking_repeat_extra_information_"+i).val("");
                    $("#instant_booking_repeat_by_date"+i).prop("checked", true);
                }
            });

            $("#id_cancel_blockout_"+i).click(function(e){
                i = e.target.id.substr(-1,1);
                clearblockout(i);
                $("#blockout_"+i).attr("style", "display:none;");
                hideblockout(i);
            });

            $("#id_cancel_instant_booking_"+i).click(function(e){
                i = e.target.id.substr(-1,1);
                clearinstantbooking(i);
                $("#instant_booking_"+i).attr("style", "display:none;");
                hideinstantbooking(i);
            });

            $("#id_add_blockout_"+i).click(function(e){
                if($("#id_calendar-blockout_start_datetime_"+i).val() == '' || $("#id_calendar-blockout_end_datetime_"+i).val() == '')
                {
                    return;
                }
                if($("#id_calendar-blockout_repeat_"+i).is(':checked') && $("#id_calendar-blockout_repeat_cycle_"+i).val().trim().toLowerCase()!='monthly')
                {
                    start_datetime = Date.parseExact($("#id_calendar-blockout_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    end_datetime = Date.parseExact($("#id_calendar-blockout_end_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    if(start_datetime.getDate()!=end_datetime.getDate())
                    {
                        alert("For daily/weekly repeated time slots, please keep the start and end time within the same day.");
                        return;
                    }
                }
                i=1;
                for(i=1;i<=5;i++)
                {
                    if(!$("#id_delete_blockout_"+i).length)
                    {
                        break;
                    }
                }
                saveblockout(i);
                if(i!=5)
                {
                    clearblockout(5);
                }
                hideblockout(5);
                $("#blockout_title_"+i).attr("style", "");
                $("#blockout_5").attr("style", "display:none;");
                handleAddingItem("blockout", i);
            });

            $("#id_add_instant_booking_"+i).click(function(e){
                if($("#id_calendar-instant_booking_start_datetime_"+i).val() == '' || $("#id_calendar-instant_booking_end_datetime_"+i).val() == '')
                {
                    return;
                }
                if($("#id_calendar-instant_booking_repeat_"+i).is(':checked') && $("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim().toLowerCase()!='monthly')
                {
                    start_datetime = Date.parseExact($("#id_calendar-instant_booking_start_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    end_datetime = Date.parseExact($("#id_calendar-instant_booking_end_datetime_"+i).val(), "yyyy-MM-dd HH:mm");
                    if(start_datetime.getDate()!=end_datetime.getDate())
                    {
                        alert("For daily/weekly repeated time slots, please keep the start and end time within the same day.");
                        return;
                    }
                }
                i=1;
                for(i=1;i<=5;i++)
                {
                    if(!$("#id_delete_instant_booking_"+i).length)
                    {
                        break;
                    }
                }
                saveinstantbooking(i);
                if(i!=5)
                {
                    clearinstantbooking(5);
                }
                hideinstantbooking(5);
                $("#instant_booking_title_"+i).attr("style", "");
                $("#instant_booking_5").attr("style", "display:none;");
                handleAddingItem("instant_booking", i);
            });

            //initial values
            if($("#id_calendar-instant_booking_start_datetime_"+i).val() && $("#id_calendar-instant_booking_end_datetime_"+i).val() && $("#id_calendar-instant_booking_start_datetime_"+i).val()!='' && $("#id_calendar-instant_booking_end_datetime_"+i).val()!='')
            {
                if($("#id_calendar-instant_booking_repeat_"+i).is(" :checked"))
                {
                    if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim() == "Daily")
                    {
                        saveDailyEvent("instant_booking", i, "#FECB2F");
                    }
                    else if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim() == "Weekly")
                    {
                        saveWeeklyEvent("instant_booking", i, "#FECB2F");
                    }
                    else if($("#id_calendar-instant_booking_repeat_cycle_"+i).val().trim() == "Monthly")
                    {
                        saveMonthlyEvent("instant_booking", i, "#FECB2F");
                    }
                }
                else
                {
                    saveSingleEvent("instant_booking", i, "#FECB2F");
                }
                handleAddingItem("instant_booking", i);
                $("#instant_booking_title_"+i).attr("style","");
            }

            if($("#id_calendar-blockout_start_datetime_"+i).val() && $("#id_calendar-blockout_start_datetime_"+i).val() != '' && $("#id_calendar-blockout_end_datetime_"+i).val() && $("#id_calendar-blockout_end_datetime_"+i).val() != '')
            {
                if($("#id_calendar-blockout_repeat_"+i).is(" :checked"))
                {
                    if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim() == "Daily")
                    {
                        saveDailyEvent("blockout", i, "#FB0F1C");
                    }
                    else if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim() == "Weekly")
                    {
                        saveWeeklyEvent("blockout", i, "#FB0F1C");
                    }
                    else if($("#id_calendar-blockout_repeat_cycle_"+i).val().trim() == "Monthly")
                    {
                        saveMonthlyEvent("blockout", i, "#FB0F1C");
                    }
                }
                else
                {
                    saveSingleEvent("blockout", i, "#FB0F1C");
                }
                handleAddingItem("blockout", i);
                $("#blockout_title_"+i).attr("style","");
            }
        }

        $("#save-and-exit").click(function(e){
            saveandexit();
            $("#saved").val("true");
        });

        $("#save-and-exit-top").click(function(e){
            saveandexit();
            $("#saved").val("true");
        });

        $("#next-step").click(function(e){
            saveandexit();
            $("#saved").val("true");
        });

        $("#last-step").click(function(e){
            $("#saved").val("true");
        });
    });

    $(window).bind('beforeunload', function(e){
/*      
        if(document.activeElement.type!="submit")
        {
            return 'You have unsaved changes.';
        }
*/
        if($("#saved").val()!="true" && $("#edit").val()=="true")
        {
            //$("#form_calendar").trigger('submit');
            //$("#form_calendar").submit();
            return 'You are about to leave this page.';
        }
    });

</script>
{%endblock%}