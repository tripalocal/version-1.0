{% extends "app/layout.html" %}
{% load staticfiles %}
{% load mathfilters %}
{% load i18n %}

{% block head %}
    <title>{% trans 'Custom Itinerary' %}</title>
    <link href="{% static 'experiences/content/search.css' %}" rel="stylesheet">
    <link href="{% static 'bootstrap3_datetime/css/bootstrap-datetimepicker.min.css' %}" type="text/css" media="all" rel="stylesheet" />
    <link href="{% static 'experiences/content/custom-itinerary.css' %}" rel="stylesheet"/>
{% endblock %}

{% block content %}
<form id="itinerary_form" action="" method="post">
  {% csrf_token %}
  <div style="display:none;">
  <!-- TODO -->
    {{form.start_datetime}}
    {{form.end_datetime}}
    {{form.city}}
    {{form.guest_number}}
    {{form.language}}
    {{form.sort}}
    {{form.age_limit}}
    {{form.tags}}
    {{form.all_tags}}
    {{form.itinerary_string}}
  </div>
  <!-- Top search bar -->
  <div class="basic-search">
    <div class="container">
      <div class="row">
        <div class="form-inline">
          <h3 class="form-header">{% trans "Title" %}</h3>
          <input type="text" class="form-control" id="itinerary-title" style="width:220px;">
        </div>
        <div class="form-inline">
          <h3 class="form-header">{% trans "Date" %}</h3>
          <input type="text" class="form-control" id="itinerary-start-date" style="width:100px; margin-right:10px;">
          <input type="text" class="form-control" id="itinerary-end-date" style="width:100px;">
        </div>
        <div class="form-inline right-group" style="margin-right:0;">
          <h3 class="form-header">{% trans "Group size" %}</h3>
          <button id="add-adults" type="button" class="btn btn-grey"data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" data-content="
            <div class='form-goup'>
              <select class='form-control'><option>1 Adult</option></select>
            </div>
              <button class='btn btn-primary'>Add</button>
              <button class='btn btn-default' style='margin-right:0;' onclick='$(&quot;#add-adults&quot;).popover(&quot;hide&quot;);'>Cancel</button>
            ">Adult x 5
          </button>
          <button id="add-kids" type="button" class="btn btn-default"data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" data-content="
            <div class='form-goup'>
              <select class='form-control'><option>1 Kid</option></select>
            </div>
              <button class='btn btn-primary'>Add</button>
              <button class='btn btn-default' style='margin-right:0;' onclick='$(&quot;#add-kids&quot;).popover(&quot;hide&quot;);'>Cancel</button>
            ">+ Add Kids
          </button>
        </div>
      </div>
      <div class="row">
        <div class="form-inline">
          <h3 class="form-header">{% trans "Location" %}</h3>
          <button id="" type="button" class="btn btn-grey" data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" data-content="
            <div class='form-group'>
              <p>Location</p>
              <select class='form-control'><option>Melbourne</option></select>
            </div>
            <div class='form-goup'>
              <p>Duration</p>
              <select class='form-control'><option>1 Day</option></select>
            </div>
              <button class='btn btn-primary'>Add</button>
              <button class='btn btn-default' style='margin-right:0;' onclick='$(&quot;#&quot;).popover(&quot;hide&quot;);'>Cancel</button>
              <button class='btn btn-danger'>Delete Location</button>
            ">Melbourne <span class="badge">3</span>
          </button>
          <button id="" type="button" class="btn btn-grey" data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" data-content="
            <div class='form-group'>
              <p>Location</p>
              <select class='form-control'><option>Melbourne</option></select>
            </div>
            <div class='form-goup'>
              <p>Duration</p>
              <select class='form-control'><option>1 Day</option></select>
            </div>
              <button class='btn btn-primary'>Add</button>
              <button class='btn btn-default' style='margin-right:0;' onclick='$(&quot;#&quot;).popover(&quot;hide&quot;);'>Cancel</button>
              <button class='btn btn-danger'>Delete Location</button>
            ">Sydney <span class="badge">2</span>
          </button>
          <button id="add-city" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" data-content="
            <div class='form-group'>
              <p>Location</p>
              <select class='form-control'><option>Melbourne</option></select>
            </div>
            <div class='form-goup'>
              <p>Duration</p>
              <select class='form-control'><option>1 Day</option></select>
            </div>
              <button class='btn btn-primary'>Add</button>
              <button class='btn btn-default' style='margin-right:0;' onclick='$(&quot;#add-city&quot;).popover(&quot;hide&quot;);'>Cancel</button>
            "> + Add <span class="badge">4 left</span>
          </button>
        </div>
        <div class="form-inline right-group">
          <h3 class="form-header"> </h3>
          <button class="btn btn-default">Preview</button>
          <button class="btn btn-default">Export PDF</button>
          <button class="btn btn-primary">Email</button>
          <!-- TODO -->
          <input class="btn btn-default" id="itinerary_search" type="submit" value="{% trans "Search" %}" name="Search">
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-sm-6">
        <!-- Left section -->
        <div class="section">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#experience" aria-controls="experience" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/hot-56.svg' %}"></a></li>
            <li role="presentation"><a href="#flight" aria-controls="flight" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/flight.svg' %}"></a></li>
            <li role="presentation"><a href="#transfer" aria-controls="transfer" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/transfer.svg' %}"></a></li>
            <li role="presentation"><a href="#accommodation" aria-controls="accommodation" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/accommodation.svg' %}"></a></li>
            <li role="presentation"><a href="#restaurant" aria-controls="restaurant" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/restaurant.svg' %}"></a></li>
            <li role="presentation"><a href="#suggestion" aria-controls="suggestion" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/itinerary.svg' %}"></a></li>
            <li role="presentation"><a href="#pricing" aria-controls="pricing" role="tab" data-toggle="tab"><img src="{% static 'experiences/img/price.svg' %}"></a></li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="experience">
              <div class="input-group">
                <span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
                <input type="text" class="form-control">
              </div>
              <div class="column" id="experience_column">

              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="flight">
              <button class="btn btn-default" style="float:right;">+ Add Flight</button>
              <div class="column" id="flight_column">
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Such experience title</h3>
                    <p>Very description wow</p>
                    <p>2 hrs &middot; English &middot; <strong>Private</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>3239</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Another one</h3>
                    <p>Very description wow</p>
                    <p>9 hrs &middot; English &middot; <strong>Public</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>339</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="transfer">
              <button class="btn btn-default" style="float:right">+ Add Transfer</button>
              <div class="column" id="transfer_column">
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Such experience title</h3>
                    <p>Very description wow</p>
                    <p>2 hrs &middot; English &middot; <strong>Private</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>3239</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Another one</h3>
                    <p>Very description wow</p>
                    <p>9 hrs &middot; English &middot; <strong>Public</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>339</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="accommodation">
              <button class="btn btn-default" style="float:right">+ Add Accommodation</button>
              <div class="column" id="accommodation_column">
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Such experience title</h3>
                    <p>Very description wow</p>
                    <p>2 hrs &middot; English &middot; <strong>Private</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>3239</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Another one</h3>
                    <p>Very description wow</p>
                    <p>9 hrs &middot; English &middot; <strong>Public</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>339</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="restaurant">
              <button class="btn btn-default" style="float:right">+ Add Restaurant</button>
              <div class="column" id="restaurant_column">
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Such experience title</h3>
                    <p>Very description wow</p>
                    <p>2 hrs &middot; English &middot; <strong>Private</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>3239</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Another one</h3>
                    <p>Very description wow</p>
                    <p>9 hrs &middot; English &middot; <strong>Public</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>339</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="suggestion">
              <button class="btn btn-default" style="float:right">+ Add Suggestion</button>
              <div class="column" id="suggestion_column">
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Such experience title</h3>
                    <p>Very description wow</p>
                    <p>2 hrs &middot; English &middot; <strong>Private</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>3239</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Another one</h3>
                    <p>Very description wow</p>
                    <p>9 hrs &middot; English &middot; <strong>Public</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>339</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="pricing">
              <button class="btn btn-default" style="float:right">+ Add Pricing</button>
              <div class="column" id="pricing_column">
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Such experience title</h3>
                    <p>Very description wow</p>
                    <p>2 hrs &middot; English &middot; <strong>Private</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>3239</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
                <div class="exp-box-sm portlet">
                  <div class="exp-img portlet-header"></div>
                  <div class="exp-info portlet-header">
                    <h3>Another one</h3>
                    <p>Very description wow</p>
                    <p>9 hrs &middot; English &middot; <strong>Public</strong></p>
                  </div>
                  <div class="exp-price portlet-header">
                    <p>$AUD</p>
                    <h2>339</h2>
                    <p>{% trans "per person" %}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <!-- Right section -->
        <div class="section">
          <h1 class="section-heading">Itinerary</h1>
          <h2 class="price-line">$AUD 3456 per person (Total of $AUD 23456)</h2>
          <div class="section-box">
            <p>Melbourne 3 Days</p>
          </div>
          <div class="section-box">
            <p>Day 1</p>
            <div class="column">
            </div>
          </div>
          <div class="section-box">
            <p>Day 2</p>
            <div class="column">
            </div>
          </div>
          <div class="section-box">
            <p>Day 3</p>
            <div class="column">
            </div>
          </div>
          <div class="section-box-add">
            <span class="add-sign">+</span>
            <p>Sydney 2 Days</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script language="javascript" type="text/javascript" src="{% static 'app/scripts/jquery.stickem.js' %}"></script>
    <script type='text/javascript' src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.0.7/components/dropdown.min.js"></script>
    <script type='text/javascript' src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.0.7/components/transition.min.js"></script>
    <script type="text/javascript" src="{% static 'bootstrap3_datetime/js/moment.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'bootstrap3_datetime/js/bootstrap-datetimepicker.min.js' %}"></script>
    {%if LANGUAGE == "zh-CN"%}
    <script type="text/javascript" src="{% static 'bootstrap3_datetime/js/locales/bootstrap-datetimepicker.zh-CN.js' %}"></script>
    {%endif%}
    <script type="text/javascript" src="{% static 'experiences/scripts/custom_itinerary.js' %}"></script>

    <script type="text/javascript">
    $(document).ready(function()
    {
        //fill out the left panel
        experience_column = $("#experience_column");
        flight_column = $("#flight_column");
        transfer_column = $("#transfer_column");
        accommodation_column = $("#accommodation_column");
        restaurant_column = $("#restaurant_column");

        {%for day in itinerary%}
        i = {{forloop.counter}};
        new_day = "<div id='experience_day_" + i + "'></div>";
        experience_column.append(new_day);
            {% for experience in day.experiences %}
            {% if 'private' in experience.type.lower or 'product' in experience.type.lower %}
            new_experience = "<div class='exp-box-sm portlet'>" + 
                                "<div class='exp-img portlet-header'>" +
                                    "<img src='{{MEDIA_URL}}thumbnails/experiences/experience{{experience.id}}_1.jpg' alt='{{experience.title}}'/>" +
                                "</div>" +
                                "<div class='exp-info portlet-header'>" + 
                                    "<h3>{{experience.title}}</h3>" +
                                    "<p>{{experience.description|escapejs|slice:"0:20"}}</p>" +
                                    "<p>{{experience.duration}} {% trans 'hr(s)' %} &middot; " +
                                       "{%if experience.language == 'english;mandarin;'%}English / 中文{%else%}English{%endif%} &middot;" +
                                       "{% if experience.type == 'PRIVATE' or experience.type == 'PrivateProduct'%}<strong>{% trans 'Private' %}</strong>{% endif %}</p>" +
                                "</div>"+
                                "<div class='exp-price portlet-header'>" +
                                    "<p>{{experience.dollarsign}}{{experience.currency}}</p>" +
                                    "<h2>{{experience.price}}</h2>" +
                                    "<p>{% trans 'per person' %}</p>" +
                                "</div>" +
                            "</div>";
            $("#experience_day_"+ i).append(new_experience);
            {% elif experience.type == "Flight" %}
            //TODO
            {% elif experience.type == "Transfer" %}
            //TODO
            {% elif experience.type == "Accommodation" %}
            //TODO
            {% elif experience.type == "Restaurant" %}
            //TODO
            {% endif %}
            {% endfor %}
        {% endfor %}

        $("#button_email").click(function(e){
            var itinerary = [];
            dict={"id":"",
                  "date":"","time":"",
                  "guest_number":1};
            itinerary.push(dict);
            $("#id_itinerary_string").val(JSON.stringify(itinerary));
        })
    })
    </script>
{% endblock %}
