{% extends "app/layout.html" %}
{% load staticfiles %}
{% load mathfilters %}
{% load i18n %}

{%block head %}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Discover {{ city }}</title>
{%endblock%}

{% block content %}   
    <div class="">
        <form id="search_form" action="/s/melbourne/" method="post">
            {% csrf_token %}

            <div id="criteria_div">
                <div id="mandatory_criteria_div">
                    <div id="date_destination_div" style="float:left;width:390px;">
                        <div id="add_day_1_div">
                            <div class="data-icon"> 
                                <p class="date-exp">Dates</p>
                            </div>
                            {{form.city}}
                            <div class="input-group date" id="id_start_datetime_picker_day_1" style="float:left;width:150px;">
                                {{form.start_date}}
                            </div>
                            <div class="input-group date" id="id_end_datetime_picker_day_1" style="float:left;width:150px;">
                                {{form.end_date}}
                            </div>
                        </div>
                    </div>
                    <div class="vertical-bar"></div>
                    <div id="guest_number_div" style="float:left;width:150px;">
                        <div class="people"> 
                            <p class="people-exp">People</p>
                            <p class="people-descri">We offer private group</p>
                        </div>
                        {{form.guest_number}}
                    </div>
                    <div class="vertical-bar" style="margin-left:70px;"></div>
                    <div id="language_div" style="float:left;">
                        <div class="language-icon">
                            <p class="language-exp">Language</p>
                        </div> 
                    </div>
                    <div class="language-choice-checkbox"> 
                        {{form.language}} 
                        <input id="language_English" type="checkbox" value="English" class="css-checkbox" name="checkbox-eng"><label id="language_English_label" for="checkbox-eng" class="css-label lite-x-cyan">English</label>
                        <br> 
                        <input id="language_Mandarin" type="checkbox" value="Chinese" class="css-checkbox" name="checkbox-cn"><label id="language_Mandarin_label" for="checkbox-cn" class="css-label lite-x-cyan" style="margin-top:10px;">中文</label> 
                    </div>
                    <div class="vertical-bar"></div>
                    <div id="search-search-button">
                        <input class="btn-block btn btn-default" style="padding-bottom:25px; width:100px;" id="itinerary-search" type="submit" value="Search" name="Search">
                    </div>
                    <div id="itinerary-search-button">
                    </div>
                </div>
                <div id="optional_criteria_div" style="display:none;">
                    <div id="optional_criteria_container">
                        <div class="interests-icon">
                            <p class="interests-exp">Interests</p>
                        </div>

                        <div id="tags_div">
                            {{form.tags}}
                            {{form.all_tags}}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="container-fluid searchresult">
    	<div class="row">
            <div class="fixCenter">
                <div id="more-filters-div">
                    <button class="btn-block btn btn-default" id="more_filters" type="button" value="More Filters" style="padding-bottom:25px; width:150px;float:left;">More Filters</button>
                    <label style="float:right;">{{length}} Experiences &#8226; {{city_display_name}}</label>
                </div>
                <div class="expBox">
                    <!-- Each Individual Experiene Listing -->
                    {% for experience, review, formattedTitle, BGImageURL, profileImageURL in cityExperienceList %}
                    <div class="expList">
                        <a href="/experience/{{experience.id}}">
                            <div class="listingImg" style="background-image:url({{MEDIA_URL}}{{BGImageURL}});">
                                <div class="priceBox">
                                From $<span>{{ experience.price|mul:1.429|floatformat:"0" }}</span> AUD/person
                                </div>
                            </div>
                        </a>
                        <a href="/experience/{{experience.id}}"><h3>{{ formattedTitle }}</h3></a>
                        <div class="profile-sm"><img src="{{MEDIA_URL}}{{profileImageURL}}" width="240" height="240"></div>
          
                        <p style="overflow-y:hidden; height:100px">{{ experience.description }}</p>
                        <div class="listingFooter"><a href="http://tripalocal.com/stage1css/search_result.html#" style="display:none">{{ review }} reviews</a> {{ experience.duration }} hrs &#8226; {%if experience.language == "english;mandarin;"%}English / 中文{%else%}English{%endif%}</div>
                    </div>
                    {% endfor %}
                    <div class="expList">
                        <div class="listingImg" style="background-image:url({{MEDIA_URL}}request.jpg);"></div>
                        <h3>Can't find the experience you Want?</h3>
                        <div class="profile-sm"><img src="{{MEDIA_URL}}profile_default.jpg" width="240" height="240"></div>
                        <p style="overflow-y:hidden; height:100px">Email us at <a href="mailto:enquiries@tripalocal.com">enquiries@tripalocal.com</a> with the preferred experience, the dates and times and we will get back to you within 48 hours with a customised experience just for you!</p>
                        <div class="listingFooter">We offer exclusive experiences with private groups</div>
                    </div>
                </div>       
            </div>
        </div>
    </div>
    <!-- /.container -->

{% endblock %}

{% block scripts %}
<script charset="utf-8" type="text/javascript">
    $(document).ready(function(){
        $("#id_city").addClass("destination_city");
        $("#id_city").val("{{city}}");

        language = $("#id_language").val().split(",");
        for(i=0;i<language.length;i++)
        {
            $("#language_"+language[i]).prop('checked',true);
            $("#language_"+language[i]+"_label").attr("class","css-label lite-cyan-check");
        }

        language=['English','Mandarin'];
        for(i=0;i<language.length;i++)
        {
            $("#language_"+language[i]+"_label").click(function(e){
                id = "language_"+this.id.split("_")[1];
                if($("#"+id).prop('checked'))
                {
                    $("#"+id).prop('checked',false);
                    $(this).attr("class","css-label lite-x-cyan");
                }
                else
                {
                    $("#"+id).prop('checked',true);
                    $(this).attr("class","css-label lite-cyan-check");
                }
            });
        }

        all_tags = $("#id_all_tags").val().split(",");
        tags = $("#id_tags").val().split(",");
        for(i=0;i<all_tags.length>0;i++)
        {
            if($("#id_tags").val().length>0 && tags.length>0 && $.inArray(all_tags[i], tags)<0)
            {
                new_tag = "<div class=\"tag-box\"><label id=\"tag_" + (i+1) +"\" class=\"tag-non-selected\">" + all_tags[i] + "</label><button type=\"button\" id=\"tag_button_" + (i+1) +"\" class=\"tag-button\">&#10003</button></div>";
            }
            else
            {
                new_tag = "<div class=\"tag-box\"><label id=\"tag_" + (i+1) +"\" class=\"tag-selected\">" + all_tags[i] + "</label><button type=\"button\" id=\"tag_button_" + (i+1) +"\" class=\"tag-button\">&#10007</button></div>";
            }

            $("#tags_div").append(new_tag);

            $("#tag_button_"+(i+1)).click(function(e){
                id = e.target.id.split("_")[2];
                if($("#tag_"+id).attr("class") == "tag-selected")
                {
                    $("#tag_button_"+id).html("&#10003");
                    $("#tag_"+id).attr("class", "tag-non-selected");
                }
                else
                {
                    $("#tag_button_"+id).html("&#10007");
                    $("#tag_"+id).attr("class", "tag-selected");
                }
            });
        }
    });

    $("#id_city").change(function(e){
        $("#search_form")[0].action = "/s/" + $("#id_city").val() + "/";
    });

    $("#itinerary-search").click(function(e){
        $("#id_city").change();
        $("#id_tags").val("");
        for(i=1;$("#tag_"+i).length>0;i++)
        {
            if($("#tag_"+i).attr("class") == "tag-selected")
            {
                $("#id_tags").val($("#id_tags").val() + $("#tag_"+i).text() + ",");
            }
        }
        tags = $("#id_tags").val();
        tags = tags.substring(0,tags.length-1);
        $("#id_tags").val(tags);

        $("#id_language").val("");

        language = ['Mandarin','English'];
        for(i=0;i<language.length;i++)
        {
            if($("#language_"+language[i]).prop('checked') == true)
            {
                $("#id_language").val($("#id_language").val() + language[i] + ",");
            }
        }
        l = $("#id_language").val();
        l = l.substring(0,l.length-1);
        $("#id_language").val(l);

    });

    $("#more_filters").click(function(e){
        tags_div = $("#optional_criteria_div");
        if(tags_div.css("display")=="none")
        {
            tags_div.css("display", "inline-block");
            $("#more_filters").text("Less Filters");
        }
        else
        {
            tags_div.css("display", "none");
            $("#more_filters").text("More Filters");
        }
    });
</script>
{% endblock %}