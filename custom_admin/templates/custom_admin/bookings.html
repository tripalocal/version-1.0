<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Bookings</title>

{% load staticfiles %}
<link href="{% static 'app/content/globalReset.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'app/content/browserStyle.css' %}" rel="stylesheet" type="text/css" />
<script language="javascript" type="text/javascript" src="{% static 'app/scripts/jquery-1.10.2.js' %}"></script>
<script language="javascript" type="text/javascript" src="{% static 'custom_admin/scripts/admin_booking.js' %}"></script>

</head>

<body>
<form id="booking-form" action="" method="post">{% csrf_token %}
{{time_changed_status}}
<div class="container">
  <div class="header">
    <div class="logo"><img src="{{ MEDIA_URL }}img/tripalocal_Logo.png" width="105" height="60" /></div>
    <ul class="menu"><li><a href="#">Experiences</a></li><li>Bookings</li>
    <li><a href="/custom_admin/payment">Payment</a></li></ul>
    <div class="account">Hi, {{user_name}} | <a href="/accounts/logout/">Logout</a></div>
  </div>
  <div class="fullColumn">
    {% ifequal status 'success'%}
      <div class="notification" id="change_time_success_notification">Update has been successful.</div>
    {% endifequal %}
    {% ifequal status 'failed'%}
      <div class="notification_red" id="change_time_failed_notification">Update has been failed.</div>
  	{% endifequal %}

    <div class="operation"></div>
  	<ul class="subMenu">
    <li>Current Bookings</li>
    <li id="activated"><a href="/custom_admin/archive/">Archived</a></li>
   
    </ul>
    <div class="clear"></div>
  {% csrf_token %}
<table border="0" cellspacing="0" cellpadding="0">
    <tr>
    <td colspan="11" class="tableEdit">&nbsp;&nbsp;↓
<input name="input" type="button" value="Delete" onclick="deleteBookings()"/>&nbsp;&nbsp;
<input name="input" type="button" value="Email to Host" onclick="sendConfirmationEmailHost()"/>&nbsp;&nbsp;
<input name="input" type="button" value="Email to Traveller" onclick="sendConfirmationEmailGuest()"/>&nbsp;&nbsp;
<input name="input" type="button" value="Archive" onclick="archiveBookings()"/></td>
    </tr>
  <tr>
    <th scope="col"><span id="sprycheckbox1">
      <label>
        <input type="checkbox" name="checkbox1" id="checkbox1" value="all"/>
        </label>
      </span></th>
    <th scope="col"><p>Booking Time</p></th>
    <th scope="col">Experience Name</th>
    <th scope="col"  width="120">Host</th>
    <th scope="col"  width="120">Traveller</th>
    <th scope="col">Group Size</th>
    <th scope="col"> Status</th>
    <th scope="col"  width="120">Actions</th>

  </tr>
 
    {% for booking in booking_list %}
    {% if booking.status == 'requested' or booking.status == 'accepted' or booking.status == 'rejected' or booking.status == 'no_show' or booking.status == 'paid' %}
      <tr>
        <td><input type="checkbox" name="admin_panel_booking_id_checkbox" value="{{booking.id}}"/></td>
        <td id="td-booking-datetime-{{ booking.id }}" >{{ booking.datetime }}</td>
        <td><a href="/experience/{{booking.experience.id}}" target="_blank">{{ booking.experience.title }}</a></td>
        <td>
          {% for host in booking.experience.hosts.all %}
            <p>{{ host.first_name }}&nbsp;{{ host.last_name }}</p>
            <p>{{ host.registereduser.phone_number }}</p>
          {% endfor %}
        </td>
        <td>
          <p>{{ booking.user.first_name }}&nbsp;{{ booking.user.last_name }}</p>
          <p>{{ booking.user.registereduser.phone_number }}</p>
        </td>
        <td>{{ booking.guest_number }}</td>
        <td id="td-status-description-{{booking.id}}" style="color:{{booking.color}};">{{ booking.status_description }}</td>
        <td id="td-action-{{booking.id}}">
          {% for action in booking.actions %}
            {% ifequal action 'Change time'%}
              <a href="#" id="booking-change-time-link-{{booking.id}}">{{action}}</a>
            {% endifequal %}

            {% ifequal action 'Mark as no show' %}
              <a href="#" onclick="markAsNoShow({{booking.id}})">{{action}}</a>
            {% endifequal %}

            {% ifequal action 'Reopen booking' %}
              <a href="#" onclick = "reopenBooking({{ booking.id }})">{{action}}</a>
            {% endifequal %}
            
            {% ifequal action 'Cancel booking' %}
               <a href="#" onclick = "cancelBooking({{ booking.id }})">{{action}}</a>
            {% endifequal %}

            {% ifequal action 'Upload review' %}
               <a href="#" id="booking-upload-review-link-{{booking.id}}">{{action}}</a>
            {% endifequal %}
            <br/><br/>
          {% endfor %}
        </td>
    </tr>
    {% endif %}
    {% endfor %}
  
  </table>
  </div>


  <div class="push"></div>
</div>
<div class="footer">© TRIPALOCAL Pty Ltd. All Rights Reserved, 2014</div>


<div id="change-time-popup"style="display:none">
<div id="light" class="white_content">
<div class="operation"><a href="#" id="close-change-time-button">Close</a></div>
<h1>Change time and date</h1>
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <th scope="col">Booking ID.</th>
    <th scope="col">Date</th>
    <th scope="col">Time</th>
    </tr>
  <tr>
    <td id="booking_id_in_change_time_popup"></td>
    <td>
      {{ form.new_date }}
    </td>
    <td>
      {{ form.new_time }}
    </td>
    </tr>
</table>

  <div class="tableButton">
    <input id="change-time-button" type="button" name="button" class="big_button" value="Update" />
  </div>
</div>
<div id="fade" class="black_overlay"></div>
</div>


<div id="upload-review-popup"style="display:none">
    {% csrf_token %}
<div class="white_content">
<div class="operation"><a href="#" id="close-upload-review-button">Close</a></div>
<h1>Upload review</h1>
<div class="scroll"><table border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td class="coRight">&nbsp;</td>
      <td><h1>Leave review</h1>
        <p>After you have saved this review, it will be displayed on <a href="#">Italian Home Dining Experience</a> from Yiyi Wang.</p></td>
    </tr>
        <tr>
          <td class="coRight"></td>
      <td>
        {{ form.review }}
        <br />
        {{ form.rate }}
        <br />
      </td>
      </tr>
      </table>
</div>

  <div class="tableButton">
    <input type="button" id="upload-review-button" name="button" class="big_button" value="Submit Review" />
  </div>
</div>
<div id="fade" class="black_overlay"></div>
</div>
</form>


</body>
</html>
